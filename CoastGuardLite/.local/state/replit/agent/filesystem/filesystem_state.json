{"file_contents":{"client/src/components/alert-banner.tsx":{"content":"import { X, AlertTriangle, CheckCircle2, Info, Radar } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport type { Alert } from \"@shared/schema\";\n\ninterface AlertBannerProps {\n  alert: Alert;\n  onDismiss?: () => void;\n}\n\nconst alertIcons = {\n  signal_lost: AlertTriangle,\n  drift_complete: Radar,\n  info: Info,\n  success: CheckCircle2,\n};\n\nconst alertStyles = {\n  signal_lost: \"bg-danger/10 border-danger text-danger\",\n  drift_complete: \"bg-drift/10 border-drift text-drift\",\n  info: \"bg-ocean/10 border-ocean text-ocean-dark dark:text-ocean\",\n  success: \"bg-live/10 border-live text-live\",\n};\n\nexport function AlertBanner({ alert, onDismiss }: AlertBannerProps) {\n  const alertType = alert.type as keyof typeof alertIcons;\n  const Icon = alertIcons[alertType] || Info;\n  const style = alertStyles[alertType] || alertStyles.info;\n\n  const formatTime = (date: Date) => {\n    return new Date(date).toLocaleTimeString(\"en-US\", {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  };\n\n  return (\n    <div\n      className={`flex items-center gap-4 px-4 py-3 border-l-4 rounded-r-lg ${style}`}\n      role=\"alert\"\n      data-testid={`alert-${alert.type}-${alert.id}`}\n    >\n      <Icon className=\"h-5 w-5 flex-shrink-0\" />\n      <div className=\"flex-1 min-w-0\">\n        <p className=\"text-sm font-medium\">{alert.message}</p>\n        <p className=\"text-xs opacity-70\">{formatTime(alert.timestamp)}</p>\n      </div>\n      {onDismiss && (\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className=\"h-8 w-8 flex-shrink-0 opacity-70 hover:opacity-100\"\n          onClick={onDismiss}\n          data-testid={`button-dismiss-alert-${alert.id}`}\n        >\n          <X className=\"h-4 w-4\" />\n        </Button>\n      )}\n    </div>\n  );\n}\n\ninterface AlertStackProps {\n  alerts: Alert[];\n  onDismiss?: (id: string) => void;\n  maxVisible?: number;\n}\n\nexport function AlertStack({ alerts, onDismiss, maxVisible = 3 }: AlertStackProps) {\n  const visibleAlerts = alerts.slice(0, maxVisible);\n\n  if (visibleAlerts.length === 0) return null;\n\n  return (\n    <div className=\"space-y-2\" data-testid=\"alert-stack\">\n      {visibleAlerts.map((alert) => (\n        <AlertBanner\n          key={alert.id}\n          alert={alert}\n          onDismiss={onDismiss ? () => onDismiss(alert.id) : undefined}\n        />\n      ))}\n      {alerts.length > maxVisible && (\n        <p className=\"text-xs text-muted-foreground text-center\">\n          +{alerts.length - maxVisible} more alerts\n        </p>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":2541,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/hooks/use-theme.ts":{"content":"import { useState, useEffect } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\nexport function useTheme() {\n  const [theme, setTheme] = useState<Theme>(() => {\n    if (typeof window !== \"undefined\") {\n      const stored = localStorage.getItem(\"theme\") as Theme;\n      if (stored) return stored;\n      return window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\";\n    }\n    return \"light\";\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    if (theme === \"dark\") {\n      root.classList.add(\"dark\");\n    } else {\n      root.classList.remove(\"dark\");\n    }\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme((prev) => (prev === \"light\" ? \"dark\" : \"light\"));\n  };\n\n  return { theme, setTheme, toggleTheme };\n}\n","path":null,"size_bytes":801,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"@neondatabase/serverless\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1439,"size_tokens":null},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"@/hooks/use-theme\";\n\nexport function ThemeToggle() {\n  const { theme, toggleTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-5 w-5\" />\n      ) : (\n        <Sun className=\"h-5 w-5\" />\n      )}\n      <span className=\"sr-only\">Toggle theme</span>\n    </Button>\n  );\n}\n","path":null,"size_bytes":549,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useState, useCallback } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { CoordinateDisplay } from \"@/components/coordinate-display\";\nimport { AlertStack } from \"@/components/alert-banner\";\nimport { MarineWeatherCard } from \"@/components/marine-weather-card\";\nimport { SimulationControls } from \"@/components/simulation-controls\";\nimport { LeafletMap } from \"@/components/map/leaflet-map\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport {\n  Anchor,\n  RefreshCw,\n  Clock,\n  User,\n  AlertTriangle,\n  Radar,\n  Loader2,\n  Menu,\n  X,\n  Search,\n  Ship,\n  MapPin,\n  ArrowLeft,\n  LogOut,\n  Info,\n} from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { \n  TrackingMode, \n  Alert, \n  MarineWeatherData,\n  DriftResult,\n  FishermanWithState,\n} from \"@shared/schema\";\n\nexport default function Dashboard() {\n  const { user } = useAuth();\n  const [autoRefresh, setAutoRefresh] = useState(true);\n  const [simulationHours, setSimulationHours] = useState(3);\n  const [showHeatmap, setShowHeatmap] = useState(true);\n  const [showPaths, setShowPaths] = useState(true);\n  const [sidebarOpen, setSidebarOpen] = useState(true);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedFishermanId, setSelectedFishermanId] = useState<string | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: allFishermen = [], isLoading: isFishermenLoading } = useQuery<FishermanWithState[]>({\n    queryKey: [\"/api/fishermen\", searchQuery],\n    queryFn: async () => {\n      const url = searchQuery \n        ? `/api/fishermen?search=${encodeURIComponent(searchQuery)}`\n        : \"/api/fishermen\";\n      const res = await fetch(url, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch fishermen\");\n      return res.json();\n    },\n    refetchInterval: autoRefresh ? 5000 : false,\n  });\n\n  const selectedFisherman = allFishermen.find(f => f.fisherman.id === selectedFishermanId);\n  const fishermanData = selectedFisherman ? {\n    state: selectedFisherman.state,\n    lastLocation: selectedFisherman.lastLocation,\n  } : null;\n\n  const { data: alerts = [], isLoading: isAlertsLoading } = useQuery<Alert[]>({\n    queryKey: [\"/api/alerts\"],\n    refetchInterval: autoRefresh ? 10000 : false,\n  });\n\n  // Get coordinates for weather\n  const weatherLat = fishermanData?.lastLocation?.lat;\n  const weatherLng = fishermanData?.lastLocation?.lng;\n\n  const { \n    data: weatherData, \n    isLoading: isWeatherLoading,\n    refetch: refetchWeather \n  } = useQuery<MarineWeatherData>({\n    queryKey: [\"/api/marine-weather\", weatherLat, weatherLng],\n    queryFn: async () => {\n      if (weatherLat === undefined || weatherLat === null || weatherLng === undefined || weatherLng === null) return null;\n      const res = await fetch(\n        `/api/marine-weather?lat=${weatherLat}&lng=${weatherLng}`,\n        { credentials: \"include\" }\n      );\n      if (!res.ok) throw new Error(\"Failed to fetch weather\");\n      return res.json();\n    },\n    enabled: weatherLat !== undefined && weatherLat !== null && weatherLng !== undefined && weatherLng !== null,\n  });\n\n  const { data: driftResult } = useQuery<DriftResult>({\n    queryKey: [\"/api/drift-result\", selectedFishermanId],\n    queryFn: async () => {\n      const res = await fetch(`/api/drift-result/${selectedFishermanId}`, { credentials: \"include\" });\n      if (!res.ok) return null;\n      return res.json();\n    },\n    enabled: !!selectedFishermanId && fishermanData?.state?.mode === \"drift\",\n  });\n\n  const runSimulationMutation = useMutation({\n    mutationFn: async () => {\n      const lat = fishermanData?.lastLocation?.lat;\n      const lng = fishermanData?.lastLocation?.lng;\n      \n      if (lat === undefined || lat === null || lng === undefined || lng === null || !selectedFishermanId) {\n        throw new Error(\"No location data\");\n      }\n      \n      return apiRequest(\"POST\", \"/api/simulation/run\", {\n        fishermanProfileId: selectedFishermanId,\n        lastKnownLat: lat,\n        lastKnownLng: lng,\n        simulationHours,\n        numPaths: 100,\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Drift simulation complete\",\n        description: `Generated 100 paths over ${simulationHours} hours`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/drift-result\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/alerts\"] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Simulation failed\",\n        description: error instanceof Error ? error.message : \"Unknown error\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const triggerDriftModeMutation = useMutation({\n    mutationFn: async () => {\n      if (!selectedFishermanId) throw new Error(\"No fisherman selected\");\n      return apiRequest(\"POST\", \"/api/fisherman/trigger-drift\", {\n        fishermanProfileId: selectedFishermanId,\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Drift mode activated\",\n        description: \"Signal loss triggered manually\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/fishermen\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/alerts\"] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Failed to trigger drift mode\",\n        description: error instanceof Error ? error.message : \"Unknown error\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const exitDriftModeMutation = useMutation({\n    mutationFn: async () => {\n      if (!selectedFishermanId) throw new Error(\"No fisherman selected\");\n      return apiRequest(\"POST\", \"/api/fisherman/exit-drift\", {\n        fishermanProfileId: selectedFishermanId,\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Drift mode exited\",\n        description: \"Now awaiting GPS signal from fisherman\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/fishermen\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/alerts\"] });\n    },\n  });\n\n  const dismissAlertMutation = useMutation({\n    mutationFn: async (alertId: string) => {\n      return apiRequest(\"PATCH\", `/api/alerts/${alertId}/dismiss`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/alerts\"] });\n    },\n  });\n\n  const handleDismissAlert = useCallback((alertId: string) => {\n    dismissAlertMutation.mutate(alertId);\n  }, []);\n\n  const mode: TrackingMode = fishermanData?.state?.mode || \"live\";\n  const isConnected = fishermanData?.state?.status === \"online\";\n  const lastLocation = fishermanData?.lastLocation;\n  const lastUpdateTime = lastLocation?.timestamp ? new Date(lastLocation.timestamp) : null;\n\n  const formatTimeSince = (date: Date | null) => {\n    if (!date) return \"â€”\";\n    const seconds = Math.floor((Date.now() - date.getTime()) / 1000);\n    if (seconds < 60) return `${seconds}s ago`;\n    const minutes = Math.floor(seconds / 60);\n    if (minutes < 60) return `${minutes}m ago`;\n    const hours = Math.floor(minutes / 60);\n    return `${hours}h ${minutes % 60}m ago`;\n  };\n\n  const mapMarkers = [];\n  \n  if (selectedFishermanId && lastLocation) {\n    mapMarkers.push({\n      lat: lastLocation.lat,\n      lng: lastLocation.lng,\n      type: isConnected ? (\"live\" as const) : (\"lastKnown\" as const),\n      popup: isConnected ? \"Live Location\" : \"Last Known Location\",\n    });\n  } else {\n    allFishermen.forEach(f => {\n      if (f.lastLocation) {\n        mapMarkers.push({\n          lat: f.lastLocation.lat,\n          lng: f.lastLocation.lng,\n          type: f.state?.status === \"online\" ? (\"live\" as const) : (\"lastKnown\" as const),\n          popup: `${f.fisherman.fishermanName} (${f.fisherman.boatName})`,\n        });\n      }\n    });\n  }\n\n  const driftPaths = driftResult?.driftPaths?.map((path, i) => ({\n    points: path,\n    color: `hsl(${(i * 15) % 360}, 70%, 50%)`,\n  })) || [];\n\n  const heatmapPoints = driftResult?.heatmapPoints || [];\n\n  const unreadAlerts = alerts.filter((a) => !a.read);\n\n  const getMapCenter = (): [number, number] => {\n    if (selectedFishermanId && lastLocation) {\n      return [lastLocation.lat, lastLocation.lng];\n    }\n    if (allFishermen.length > 0 && allFishermen[0].lastLocation) {\n      return [allFishermen[0].lastLocation.lat, allFishermen[0].lastLocation.lng];\n    }\n    return [13.0827, 80.2707];\n  };\n\n  // Get online fishermen count\n  const onlineCount = allFishermen.filter(f => f.state?.status === \"online\").length;\n\n  return (\n    <div className=\"h-screen bg-background flex overflow-hidden\">\n      <aside\n        className={`fixed inset-y-0 left-0 z-40 w-80 bg-sidebar border-r transform transition-transform duration-200 lg:relative lg:translate-x-0 overflow-hidden ${\n          sidebarOpen ? \"translate-x-0\" : \"-translate-x-full\"\n        }`}\n      >\n        <div className=\"flex flex-col h-full overflow-hidden\">\n          <div className=\"flex items-center justify-between p-4 border-b shrink-0\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-ocean rounded-lg\">\n                <Anchor className=\"h-5 w-5 text-white\" />\n              </div>\n              <div>\n                <h1 className=\"font-semibold\">CoastGuard Lite</h1>\n                <p className=\"text-xs text-muted-foreground\">Dashboard</p>\n              </div>\n            </div>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"lg:hidden\"\n              onClick={() => setSidebarOpen(false)}\n              data-testid=\"button-close-sidebar\"\n            >\n              <X className=\"h-5 w-5\" />\n            </Button>\n          </div>\n\n          <ScrollArea className=\"flex-1 overflow-hidden\" style={{ isolation: 'isolate' }}>\n            <div className=\"p-4 space-y-6\">\n              <div className=\"space-y-3\">\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    placeholder=\"Search fisherman or boat...\"\n                    className=\"pl-9\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    data-testid=\"input-search-fishermen\"\n                  />\n                </div>\n              </div>\n\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-base font-semibold flex items-center gap-2\">\n                    <Ship className=\"h-4 w-4\" />\n                    Registered Fishermen\n                    <div className=\"ml-auto flex gap-1\">\n                      {onlineCount > 0 && (\n                        <Badge variant=\"default\" className=\"bg-live\">\n                          {onlineCount} Online\n                        </Badge>\n                      )}\n                      <Badge variant=\"secondary\">\n                        {allFishermen.length} Total\n                      </Badge>\n                    </div>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-2\">\n                  {isFishermenLoading ? (\n                    <div className=\"flex items-center justify-center py-4\">\n                      <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                    </div>\n                  ) : allFishermen.length > 0 ? (\n                    <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n                      {allFishermen.map((f) => (\n                        <div\n                          key={f.fisherman.id}\n                          className={`p-3 rounded-lg cursor-pointer transition-colors hover-elevate ${\n                            selectedFishermanId === f.fisherman.id\n                              ? \"bg-ocean/10 border border-ocean/30\"\n                              : \"bg-muted/50\"\n                          }`}\n                          onClick={() => {\n                            setSelectedFishermanId(\n                              selectedFishermanId === f.fisherman.id ? null : f.fisherman.id\n                            );\n                          }}\n                          data-testid={`card-fisherman-${f.fisherman.id}`}\n                        >\n                          <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                            <div className=\"flex items-center gap-2\">\n                              <User className=\"h-4 w-4 text-muted-foreground\" />\n                              <span className=\"font-medium text-sm\">{f.fisherman.fishermanName}</span>\n                            </div>\n                            <Badge\n                              variant={f.state?.status === \"online\" ? \"default\" : \"secondary\"}\n                              className={f.state?.status === \"online\" ? \"bg-live\" : \"\"}\n                            >\n                              {f.state?.status === \"online\" ? \"Online\" : f.state?.mode === \"drift\" ? \"Drift\" : \"Offline\"}\n                            </Badge>\n                          </div>\n                          <div className=\"flex items-center gap-1 mt-1 text-xs text-muted-foreground\">\n                            <Ship className=\"h-3 w-3\" />\n                            {f.fisherman.boatName}\n                          </div>\n                          {f.lastLocation && (\n                            <div className=\"flex items-center gap-1 mt-1 text-xs text-muted-foreground\">\n                              <MapPin className=\"h-3 w-3\" />\n                              {f.lastLocation.lat.toFixed(4)}, {f.lastLocation.lng.toFixed(4)}\n                            </div>\n                          )}\n                          {f.lastOnlineSession && f.state?.status === \"offline\" && (\n                            <div className=\"flex items-center gap-1 mt-1 text-xs text-muted-foreground\">\n                              <Clock className=\"h-3 w-3\" />\n                              Last online: {formatTimeSince(new Date(f.lastOnlineSession.endedAt!))}\n                            </div>\n                          )}\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <p className=\"text-sm text-muted-foreground text-center py-4\">\n                      {searchQuery ? \"No fishermen found\" : \"No fishermen registered yet\"}\n                    </p>\n                  )}\n                </CardContent>\n              </Card>\n\n              {selectedFishermanId && selectedFisherman && (\n                <>\n                  <Button\n                    variant=\"ghost\"\n                    className=\"w-full justify-start\"\n                    onClick={() => setSelectedFishermanId(null)}\n                    data-testid=\"button-back-to-all\"\n                  >\n                    <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                    Back to All Fishermen\n                  </Button>\n\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <div className=\"flex items-center justify-between gap-2\">\n                        <CardTitle className=\"text-base font-semibold flex items-center gap-2\">\n                          <User className=\"h-4 w-4\" />\n                          {selectedFisherman.fisherman.fishermanName}\n                        </CardTitle>\n                        <StatusBadge mode={mode} isConnected={isConnected} />\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                      <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                        <Ship className=\"h-4 w-4\" />\n                        <span>{selectedFisherman.fisherman.boatName}</span>\n                      </div>\n\n                      <Separator />\n\n                      {lastLocation ? (\n                        <>\n                          <div className=\"space-y-3\">\n                            <div className=\"flex items-center gap-2 text-xs font-medium text-muted-foreground uppercase tracking-wide\">\n                              <MapPin className=\"h-3 w-3\" />\n                              <span>{isConnected ? \"Live Location\" : \"Last Known Location\"}</span>\n                            </div>\n                            <CoordinateDisplay\n                              lat={lastLocation.lat}\n                              lng={lastLocation.lng}\n                              label=\"\"\n                            />\n                          </div>\n\n                          <div className=\"flex items-center justify-between text-sm bg-muted/50 rounded-lg p-3\">\n                            <div className=\"flex items-center gap-2 text-muted-foreground\">\n                              <Clock className=\"h-4 w-4\" />\n                              <span>Last Update</span>\n                            </div>\n                            <span \n                              className={`font-medium ${mode === \"drift\" ? \"text-drift\" : isConnected ? \"text-live\" : \"\"}`}\n                              data-testid=\"text-last-update\"\n                            >\n                              {formatTimeSince(lastUpdateTime)}\n                            </span>\n                          </div>\n                        </>\n                      ) : (\n                        <p className=\"text-sm text-muted-foreground text-center py-4\">\n                          No location data available\n                        </p>\n                      )}\n\n                      {mode === \"live\" && (\n                        <>\n                          <Separator />\n                          <div className=\"space-y-2\">\n                            <div className=\"flex items-center gap-2 text-xs font-medium text-muted-foreground uppercase tracking-wide\">\n                              <AlertTriangle className=\"h-3 w-3\" />\n                              <span>Emergency Actions</span>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <Button\n                                variant=\"outline\"\n                                className=\"flex-1 border-drift text-drift hover:bg-drift/10\"\n                                onClick={() => triggerDriftModeMutation.mutate()}\n                                disabled={triggerDriftModeMutation.isPending || !lastLocation}\n                                data-testid=\"button-trigger-drift\"\n                              >\n                                {triggerDriftModeMutation.isPending ? (\n                                  <>\n                                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                                    Triggering...\n                                  </>\n                                ) : (\n                                  <>\n                                    <AlertTriangle className=\"h-4 w-4 mr-2\" />\n                                    Trigger Drift Mode\n                                  </>\n                                )}\n                              </Button>\n                              <Tooltip>\n                                <TooltipTrigger asChild>\n                                  <Button variant=\"outline\" size=\"icon\" data-testid=\"button-drift-info\">\n                                    <Info className=\"h-4 w-4\" />\n                                  </Button>\n                                </TooltipTrigger>\n                                <TooltipContent side=\"top\" className=\"max-w-xs\">\n                                  <p className=\"text-sm\">\n                                    <strong>Trigger Drift Mode</strong> manually simulates a GPS signal loss scenario. \n                                    When activated, the system marks this fisherman as offline and enables drift prediction \n                                    based on their last known location, weather conditions, and ocean currents.\n                                    Use this to test emergency response procedures or when you suspect the fisherman \n                                    may be in distress but their GPS has failed.\n                                  </p>\n                                </TooltipContent>\n                              </Tooltip>\n                            </div>\n                          </div>\n                        </>\n                      )}\n\n                      {mode === \"drift\" && lastLocation && (\n                        <>\n                          <Separator />\n                          <div className=\"space-y-2\">\n                            <div className=\"flex items-center gap-2 text-xs font-medium text-muted-foreground uppercase tracking-wide\">\n                              <AlertTriangle className=\"h-3 w-3\" />\n                              <span>Drift Mode Active</span>\n                            </div>\n                            <Button\n                              variant=\"outline\"\n                              className=\"w-full border-live text-live hover:bg-live/10\"\n                              onClick={() => exitDriftModeMutation.mutate()}\n                              disabled={exitDriftModeMutation.isPending}\n                              data-testid=\"button-exit-drift\"\n                            >\n                              {exitDriftModeMutation.isPending ? (\n                                <>\n                                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                                  Exiting...\n                                </>\n                              ) : (\n                                <>\n                                  <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                                  Exit Drift Mode\n                                </>\n                              )}\n                            </Button>\n                          </div>\n                        </>\n                      )}\n                    </CardContent>\n                  </Card>\n\n                  <MarineWeatherCard\n                    data={weatherData || null}\n                    isLoading={isWeatherLoading}\n                    onRefresh={() => refetchWeather()}\n                    lastFetched={weatherData ? new Date() : null}\n                  />\n\n                  <SimulationControls\n                    hours={simulationHours}\n                    onHoursChange={setSimulationHours}\n                    showHeatmap={showHeatmap}\n                    onShowHeatmapChange={setShowHeatmap}\n                    showPaths={showPaths}\n                    onShowPathsChange={setShowPaths}\n                    onRunSimulation={() => runSimulationMutation.mutate()}\n                    isSimulating={runSimulationMutation.isPending}\n                    canSimulate={!!lastLocation}\n                  />\n                </>\n              )}\n\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <div className=\"flex items-center justify-between gap-4\">\n                    <CardTitle className=\"text-base font-semibold flex items-center gap-2\">\n                      <Radar className=\"h-4 w-4\" />\n                      Recent Alerts\n                    </CardTitle>\n                    {unreadAlerts.length > 0 && (\n                      <span className=\"text-xs bg-danger text-danger-foreground px-2 py-0.5 rounded-full\">\n                        {unreadAlerts.length}\n                      </span>\n                    )}\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  {isAlertsLoading ? (\n                    <div className=\"flex items-center justify-center py-4\">\n                      <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n                    </div>\n                  ) : alerts.length > 0 ? (\n                    <AlertStack\n                      alerts={alerts}\n                      onDismiss={handleDismissAlert}\n                      maxVisible={3}\n                    />\n                  ) : (\n                    <p className=\"text-sm text-muted-foreground text-center py-4\">\n                      No alerts\n                    </p>\n                  )}\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-base font-semibold\">Settings</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <RefreshCw className=\"h-4 w-4 text-muted-foreground\" />\n                      <Label htmlFor=\"auto-refresh\" className=\"text-sm\">\n                        Auto-refresh\n                      </Label>\n                    </div>\n                    <Switch\n                      id=\"auto-refresh\"\n                      checked={autoRefresh}\n                      onCheckedChange={setAutoRefresh}\n                      data-testid=\"switch-auto-refresh\"\n                    />\n                  </div>\n                  {autoRefresh && (\n                    <p className=\"text-xs text-muted-foreground\">\n                      Updating every 5 seconds\n                    </p>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          </ScrollArea>\n        </div>\n      </aside>\n\n      <div className=\"flex-1 flex flex-col h-screen overflow-hidden\">\n        <header className=\"sticky top-0 z-30 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b shrink-0\">\n          <div className=\"flex items-center justify-between px-4 py-3 gap-4\">\n            <div className=\"flex items-center gap-4\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"lg:hidden\"\n                onClick={() => setSidebarOpen(true)}\n                data-testid=\"button-open-sidebar\"\n              >\n                <Menu className=\"h-5 w-5\" />\n              </Button>\n              <div className=\"hidden sm:block\">\n                <h2 className=\"font-semibold\">\n                  {selectedFishermanId && selectedFisherman \n                    ? `Tracking: ${selectedFisherman.fisherman.fishermanName}`\n                    : \"Live Tracking Map\"}\n                </h2>\n                <p className=\"text-xs text-muted-foreground\">\n                  {selectedFishermanId \n                    ? (mode === \"live\" ? \"GPS signal active\" : \"Drift prediction mode\")\n                    : `${allFishermen.length} fishermen registered, ${onlineCount} online`}\n                </p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              {selectedFishermanId && (\n                <StatusBadge mode={mode} isConnected={isConnected} className=\"hidden sm:flex\" />\n              )}\n              <ThemeToggle />\n              <Button \n                variant=\"outline\" \n                size=\"icon\"\n                onClick={() => window.location.href = \"/api/logout\"}\n                data-testid=\"button-logout\"\n              >\n                <LogOut className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        </header>\n\n        <main className=\"flex-1 relative overflow-hidden\">\n          <div className=\"absolute inset-0 overflow-hidden\">\n            <LeafletMap\n              center={getMapCenter()}\n              zoom={selectedFishermanId ? 11 : 8}\n              markers={mapMarkers}\n              driftPaths={selectedFishermanId ? driftPaths : []}\n              heatmapPoints={selectedFishermanId ? heatmapPoints : []}\n              showHeatmap={showHeatmap}\n              showPaths={showPaths}\n            />\n          </div>\n\n          <div className=\"absolute bottom-4 left-4 z-20\">\n            <Card className=\"bg-background/90 backdrop-blur p-3\">\n              <div className=\"space-y-2 text-xs\">\n                <div className=\"font-medium\">Legend</div>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded-full bg-live\" />\n                  <span>Live GPS</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded-full bg-drift\" />\n                  <span>Last Known Location</span>\n                </div>\n                {showPaths && selectedFishermanId && (\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"w-6 h-0.5 bg-gradient-to-r from-purple-500 to-pink-500\" />\n                    <span>Drift Path</span>\n                  </div>\n                )}\n                {showHeatmap && selectedFishermanId && (\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"w-3 h-3 rounded-full bg-gradient-to-br from-yellow-400 to-red-500 opacity-60\" />\n                    <span>Search Area</span>\n                  </div>\n                )}\n              </div>\n            </Card>\n          </div>\n        </main>\n      </div>\n\n      {sidebarOpen && (\n        <div\n          className=\"fixed inset-0 z-30 bg-black/50 lg:hidden\"\n          onClick={() => setSidebarOpen(false)}\n        />\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":30160,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/status-badge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { Signal, SignalZero, Radar } from \"lucide-react\";\nimport type { TrackingMode } from \"@shared/schema\";\n\ninterface StatusBadgeProps {\n  mode: TrackingMode;\n  isConnected: boolean;\n  className?: string;\n}\n\nexport function StatusBadge({ mode, isConnected, className = \"\" }: StatusBadgeProps) {\n  if (mode === \"live\") {\n    return (\n      <Badge\n        className={`h-10 px-6 text-sm font-bold uppercase tracking-wide bg-live text-live-foreground border-0 gap-2 ${className}`}\n        data-testid=\"badge-status-live\"\n      >\n        <Signal className=\"h-4 w-4\" />\n        <span>Live Mode</span>\n        <span className=\"relative flex h-2 w-2\">\n          <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75\"></span>\n          <span className=\"relative inline-flex rounded-full h-2 w-2 bg-white\"></span>\n        </span>\n      </Badge>\n    );\n  }\n\n  return (\n    <Badge\n      className={`h-10 px-6 text-sm font-bold uppercase tracking-wide bg-drift text-drift-foreground border-0 gap-2 ${className}`}\n      data-testid=\"badge-status-drift\"\n    >\n      <Radar className=\"h-4 w-4\" />\n      <span>Drift Mode</span>\n    </Badge>\n  );\n}\n\ninterface ConnectionBadgeProps {\n  isConnected: boolean;\n  className?: string;\n}\n\nexport function ConnectionBadge({ isConnected, className = \"\" }: ConnectionBadgeProps) {\n  if (isConnected) {\n    return (\n      <Badge\n        className={`h-16 px-6 text-base font-semibold bg-live/10 text-live border-2 border-live/30 gap-3 ${className}`}\n        data-testid=\"badge-connection-online\"\n      >\n        <Signal className=\"h-6 w-6\" />\n        <span>Connected</span>\n        <span className=\"relative flex h-3 w-3\">\n          <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-live opacity-75\"></span>\n          <span className=\"relative inline-flex rounded-full h-3 w-3 bg-live\"></span>\n        </span>\n      </Badge>\n    );\n  }\n\n  return (\n    <Badge\n      className={`h-16 px-6 text-base font-semibold bg-danger/10 text-danger border-2 border-danger/30 gap-3 ${className}`}\n      data-testid=\"badge-connection-offline\"\n    >\n      <SignalZero className=\"h-6 w-6\" />\n      <span>Not Connected</span>\n    </Badge>\n  );\n}\n","path":null,"size_bytes":2273,"size_tokens":null},"client/src/components/marine-weather-card.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Wind, Waves, Navigation, RefreshCw, Loader2, ExternalLink } from \"lucide-react\";\nimport type { MarineWeatherData } from \"@shared/schema\";\n\ninterface MarineWeatherCardProps {\n  data: MarineWeatherData | null;\n  isLoading?: boolean;\n  onRefresh?: () => void;\n  lastFetched?: Date | null;\n  className?: string;\n}\n\nexport function MarineWeatherCard({\n  data,\n  isLoading = false,\n  onRefresh,\n  lastFetched,\n  className = \"\",\n}: MarineWeatherCardProps) {\n  const formatDirection = (degrees: number) => {\n    const directions = [\"N\", \"NE\", \"E\", \"SE\", \"S\", \"SW\", \"W\", \"NW\"];\n    const index = Math.round(degrees / 45) % 8;\n    return directions[index];\n  };\n\n  const formatTime = (date: Date | null) => {\n    if (!date) return \"Never\";\n    return new Date(date).toLocaleTimeString(\"en-US\", {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  };\n\n  return (\n    <Card className={className}>\n      <CardHeader className=\"flex flex-row items-center justify-between gap-4 pb-2\">\n        <CardTitle className=\"text-base font-semibold\">Marine Weather</CardTitle>\n        {onRefresh && (\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-8 w-8\"\n            onClick={onRefresh}\n            disabled={isLoading}\n            data-testid=\"button-refresh-weather\"\n          >\n            {isLoading ? (\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n            ) : (\n              <RefreshCw className=\"h-4 w-4\" />\n            )}\n          </Button>\n        )}\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {data ? (\n          <>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-1\">\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  <Wind className=\"h-4 w-4\" />\n                  <span className=\"text-xs\">Wind</span>\n                </div>\n                <p className=\"text-lg font-medium\" data-testid=\"text-wind-speed\">\n                  {data.windSpeed.toFixed(1)} km/h\n                </p>\n                <p className=\"text-xs text-muted-foreground\" data-testid=\"text-wind-direction\">\n                  {formatDirection(data.windDirection)} ({data.windDirection.toFixed(0)}Â°)\n                </p>\n              </div>\n              <div className=\"space-y-1\">\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  <Waves className=\"h-4 w-4\" />\n                  <span className=\"text-xs\">Waves</span>\n                </div>\n                <p className=\"text-lg font-medium\" data-testid=\"text-wave-height\">\n                  {data.waveHeight.toFixed(1)} m\n                </p>\n                <p className=\"text-xs text-muted-foreground\">Height</p>\n              </div>\n            </div>\n            <div className=\"space-y-1\">\n              <div className=\"flex items-center gap-2 text-muted-foreground\">\n                <Navigation className=\"h-4 w-4\" />\n                <span className=\"text-xs\">Ocean Current</span>\n              </div>\n              <div className=\"flex items-baseline gap-2\">\n                <p className=\"text-lg font-medium\" data-testid=\"text-current-speed\">\n                  {data.currentSpeed.toFixed(2)} m/s\n                </p>\n                <p className=\"text-xs text-muted-foreground\" data-testid=\"text-current-direction\">\n                  {formatDirection(data.currentDirection)} ({data.currentDirection.toFixed(0)}Â°)\n                </p>\n              </div>\n            </div>\n            {lastFetched && (\n              <p className=\"text-xs text-muted-foreground\">\n                Last updated: {formatTime(lastFetched)}\n              </p>\n            )}\n            <div className=\"pt-2 border-t mt-3\">\n              <a\n                href=\"https://open-meteo.com/en/docs/marine-weather-api\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"inline-flex items-center gap-1.5 text-xs text-ocean hover:underline\"\n                data-testid=\"link-weather-source\"\n              >\n                <ExternalLink className=\"h-3 w-3\" />\n                Data from Open-Meteo Marine API\n              </a>\n            </div>\n          </>\n        ) : (\n          <div className=\"py-6 text-center text-sm text-muted-foreground\">\n            {isLoading ? \"Loading weather data...\" : \"No weather data available\"}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":4616,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, real, timestamp, boolean, jsonb, integer, index } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table for Replit Auth\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// User storage table with email/password auth and role support\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").notNull().unique(),\n  passwordHash: varchar(\"password_hash\").notNull(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  role: varchar(\"role\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Fisherman profile - linked to user\nexport const fishermanProfiles = pgTable(\"fisherman_profiles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  fishermanName: text(\"fisherman_name\").notNull(),\n  boatName: text(\"boat_name\").notNull(),\n  registeredAt: timestamp(\"registered_at\").notNull().defaultNow(),\n});\n\n// Online sessions tracking - when fisherman starts/stops sharing location\nexport const onlineSessions = pgTable(\"online_sessions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  fishermanProfileId: varchar(\"fisherman_profile_id\").notNull().references(() => fishermanProfiles.id),\n  startedAt: timestamp(\"started_at\").notNull().defaultNow(),\n  endedAt: timestamp(\"ended_at\"),\n  lastLocationLat: real(\"last_location_lat\"),\n  lastLocationLng: real(\"last_location_lng\"),\n  status: varchar(\"status\").notNull().default(\"active\"),\n});\n\n// Fisherman locations with session tracking\nexport const fishermanLocations = pgTable(\"fisherman_locations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  fishermanProfileId: varchar(\"fisherman_profile_id\").notNull().references(() => fishermanProfiles.id),\n  onlineSessionId: varchar(\"online_session_id\").references(() => onlineSessions.id),\n  lat: real(\"lat\").notNull(),\n  lng: real(\"lng\").notNull(),\n  timestamp: timestamp(\"timestamp\").notNull().defaultNow(),\n  status: text(\"status\").notNull().default(\"online\"),\n});\n\nexport const driftResults = pgTable(\"drift_results\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  fishermanProfileId: varchar(\"fisherman_profile_id\").notNull().references(() => fishermanProfiles.id),\n  onlineSessionId: varchar(\"online_session_id\").references(() => onlineSessions.id),\n  simulationHours: integer(\"simulation_hours\").notNull(),\n  predictedPoints: jsonb(\"predicted_points\").notNull().$type<{lat: number, lng: number}[]>(),\n  heatmapPoints: jsonb(\"heatmap_points\").notNull().$type<{lat: number, lng: number, intensity: number}[]>(),\n  driftPaths: jsonb(\"drift_paths\").notNull().$type<{lat: number, lng: number}[][]>(),\n  generatedAt: timestamp(\"generated_at\").notNull().defaultNow(),\n});\n\nexport const alerts = pgTable(\"alerts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  fishermanProfileId: varchar(\"fisherman_profile_id\").notNull().references(() => fishermanProfiles.id),\n  type: text(\"type\").notNull(),\n  message: text(\"message\").notNull(),\n  read: boolean(\"read\").notNull().default(false),\n  timestamp: timestamp(\"timestamp\").notNull().defaultNow(),\n});\n\nexport const marineWeather = pgTable(\"marine_weather\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  lat: real(\"lat\").notNull(),\n  lng: real(\"lng\").notNull(),\n  windSpeed: real(\"wind_speed\").notNull(),\n  windDirection: real(\"wind_direction\").notNull(),\n  waveHeight: real(\"wave_height\").notNull(),\n  currentSpeed: real(\"current_speed\").notNull(),\n  currentDirection: real(\"current_direction\").notNull(),\n  fetchedAt: timestamp(\"fetched_at\").notNull().defaultNow(),\n});\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Auth schemas for registration and login\nexport const registerSchema = z.object({\n  email: z.string().email(\"Invalid email address\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().min(1, \"Last name is required\"),\n  role: z.enum([\"fisherman\", \"coastguard\"], { required_error: \"Please select a role\" }),\n});\n\nexport const loginSchema = z.object({\n  email: z.string().email(\"Invalid email address\"),\n  password: z.string().min(1, \"Password is required\"),\n});\n\nexport const insertFishermanProfileSchema = createInsertSchema(fishermanProfiles).omit({\n  id: true,\n  registeredAt: true,\n});\n\nexport const insertOnlineSessionSchema = createInsertSchema(onlineSessions).omit({\n  id: true,\n  startedAt: true,\n});\n\nexport const insertFishermanLocationSchema = createInsertSchema(fishermanLocations).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertDriftResultSchema = z.object({\n  fishermanProfileId: z.string(),\n  onlineSessionId: z.string().optional().nullable(),\n  simulationHours: z.number(),\n  predictedPoints: z.array(z.object({ lat: z.number(), lng: z.number() })),\n  heatmapPoints: z.array(z.object({ lat: z.number(), lng: z.number(), intensity: z.number() })),\n  driftPaths: z.array(z.array(z.object({ lat: z.number(), lng: z.number() }))),\n});\n\nexport const insertAlertSchema = createInsertSchema(alerts).omit({\n  id: true,\n  timestamp: true,\n  read: true,\n});\n\nexport const insertMarineWeatherSchema = createInsertSchema(marineWeather).omit({\n  id: true,\n  fetchedAt: true,\n});\n\n// Types\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\nexport type RegisterInput = z.infer<typeof registerSchema>;\nexport type LoginInput = z.infer<typeof loginSchema>;\n\nexport type InsertFishermanProfile = z.infer<typeof insertFishermanProfileSchema>;\nexport type FishermanProfile = typeof fishermanProfiles.$inferSelect;\n\nexport type InsertOnlineSession = z.infer<typeof insertOnlineSessionSchema>;\nexport type OnlineSession = typeof onlineSessions.$inferSelect;\n\nexport type InsertFishermanLocation = z.infer<typeof insertFishermanLocationSchema>;\nexport type FishermanLocation = typeof fishermanLocations.$inferSelect;\n\nexport type InsertDriftResult = z.infer<typeof insertDriftResultSchema>;\nexport type DriftResult = typeof driftResults.$inferSelect;\n\nexport type InsertAlert = z.infer<typeof insertAlertSchema>;\nexport type Alert = typeof alerts.$inferSelect;\n\nexport type InsertMarineWeather = z.infer<typeof insertMarineWeatherSchema>;\nexport type MarineWeather = typeof marineWeather.$inferSelect;\n\nexport type TrackingMode = \"live\" | \"drift\";\n\nexport interface FishermanState {\n  id: string;\n  visibleFishermanId: string;\n  fishermanName?: string;\n  boatName?: string;\n  currentLocation: { lat: number; lng: number } | null;\n  lastKnownLocation: { lat: number; lng: number } | null;\n  lastUpdateTime: Date | null;\n  status: \"online\" | \"offline\";\n  mode: TrackingMode;\n}\n\nexport interface FishermanWithState {\n  fisherman: FishermanProfile;\n  user?: User;\n  state: FishermanState | null;\n  lastLocation: { lat: number; lng: number; timestamp: Date } | null;\n  lastOnlineSession?: OnlineSession | null;\n}\n\nexport interface OnlineSessionWithLocation extends OnlineSession {\n  lastLocation?: { lat: number; lng: number } | null;\n}\n\nexport interface DriftSimulationParams {\n  fishermanProfileId: string;\n  lastKnownLat: number;\n  lastKnownLng: number;\n  simulationHours: number;\n  numPaths: number;\n  onlineSessionId?: string;\n}\n\nexport interface MarineWeatherData {\n  windSpeed: number;\n  windDirection: number;\n  waveHeight: number;\n  currentSpeed: number;\n  currentDirection: number;\n}\n","path":null,"size_bytes":8033,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"server/drift-engine.ts":{"content":"import type { MarineWeatherData } from \"@shared/schema\";\n\nconst R = 6371;\n\nexport interface DriftPoint {\n  lat: number;\n  lng: number;\n}\n\nexport interface DriftPath {\n  points: DriftPoint[];\n}\n\nexport interface HeatmapPoint {\n  lat: number;\n  lng: number;\n  intensity: number;\n}\n\nexport interface DriftSimulationResult {\n  predictedPoints: DriftPoint[];\n  heatmapPoints: HeatmapPoint[];\n  driftPaths: DriftPoint[][];\n}\n\nexport function calculateDrift(\n  lat: number,\n  lng: number,\n  windSpeed: number,\n  windDirection: number,\n  currentSpeed: number,\n  currentDirection: number,\n  hours: number\n): DriftPoint {\n  const windSpeedMs = windSpeed / 3.6;\n  \n  const windDriftFactor = 0.035;\n  const windDriftSpeed = windSpeedMs * windDriftFactor;\n  \n  const windAngle = (windDirection * Math.PI) / 180;\n  const currentAngle = (currentDirection * Math.PI) / 180;\n  \n  const windDriftX = windDriftSpeed * Math.sin(windAngle);\n  const windDriftY = windDriftSpeed * Math.cos(windAngle);\n  \n  const currentX = currentSpeed * Math.sin(currentAngle);\n  const currentY = currentSpeed * Math.cos(currentAngle);\n  \n  const totalVelocityX = windDriftX + currentX;\n  const totalVelocityY = windDriftY + currentY;\n  \n  const distanceX = totalVelocityX * hours * 3600 / 1000;\n  const distanceY = totalVelocityY * hours * 3600 / 1000;\n  \n  const latChange = (distanceY / R) * (180 / Math.PI);\n  const lngChange = (distanceX / R) * (180 / Math.PI) / Math.cos((lat * Math.PI) / 180);\n\n  return { lat: lat + latChange, lng: lng + lngChange };\n}\n\nfunction randomVariation(value: number, percentage: number): number {\n  const variation = value * (percentage / 100);\n  return value + (Math.random() * 2 - 1) * variation;\n}\n\nfunction randomAngleVariation(angle: number, maxDegrees: number): number {\n  return angle + (Math.random() * 2 - 1) * maxDegrees;\n}\n\nexport function runMonteCarloSimulation(\n  startLat: number,\n  startLng: number,\n  weather: MarineWeatherData,\n  simulationHours: number,\n  numPaths: number = 100\n): DriftSimulationResult {\n  const driftPaths: DriftPoint[][] = [];\n  const allPoints: DriftPoint[] = [];\n  const pointCounts: Map<string, number> = new Map();\n\n  for (let pathIndex = 0; pathIndex < numPaths; pathIndex++) {\n    const path: DriftPoint[] = [{ lat: startLat, lng: startLng }];\n    \n    let currentLat = startLat;\n    let currentLng = startLng;\n\n    for (let hour = 1; hour <= simulationHours; hour++) {\n      const variedWindSpeed = randomVariation(weather.windSpeed, 20);\n      const variedCurrentSpeed = randomVariation(weather.currentSpeed, 15);\n      const variedWindDirection = randomAngleVariation(weather.windDirection, 15);\n      const variedCurrentDirection = randomAngleVariation(weather.currentDirection, 10);\n\n      const newPoint = calculateDrift(\n        currentLat,\n        currentLng,\n        variedWindSpeed,\n        variedWindDirection,\n        variedCurrentSpeed,\n        variedCurrentDirection,\n        1\n      );\n\n      path.push(newPoint);\n      allPoints.push(newPoint);\n      currentLat = newPoint.lat;\n      currentLng = newPoint.lng;\n\n      const gridKey = `${newPoint.lat.toFixed(3)}_${newPoint.lng.toFixed(3)}`;\n      pointCounts.set(gridKey, (pointCounts.get(gridKey) || 0) + 1);\n    }\n\n    driftPaths.push(path);\n  }\n\n  const maxCount = Math.max(...Array.from(pointCounts.values()));\n  const heatmapPoints: HeatmapPoint[] = [];\n\n  pointCounts.forEach((count, key) => {\n    const [lat, lng] = key.split(\"_\").map(parseFloat);\n    heatmapPoints.push({\n      lat,\n      lng,\n      intensity: count / maxCount,\n    });\n  });\n\n  const predictedPoints = calculateCentroidPoints(allPoints, simulationHours);\n\n  return {\n    predictedPoints,\n    heatmapPoints,\n    driftPaths,\n  };\n}\n\nfunction calculateCentroidPoints(points: DriftPoint[], hours: number): DriftPoint[] {\n  if (points.length === 0) return [];\n\n  const pointsPerHour = Math.floor(points.length / hours);\n  const centroids: DriftPoint[] = [];\n\n  for (let h = 0; h < hours; h++) {\n    const start = h * pointsPerHour;\n    const end = start + pointsPerHour;\n    const hourPoints = points.slice(start, end);\n\n    if (hourPoints.length > 0) {\n      const avgLat = hourPoints.reduce((sum, p) => sum + p.lat, 0) / hourPoints.length;\n      const avgLng = hourPoints.reduce((sum, p) => sum + p.lng, 0) / hourPoints.length;\n      centroids.push({ lat: avgLat, lng: avgLng });\n    }\n  }\n\n  return centroids;\n}\n\nexport function generateSearchAreaRadius(heatmapPoints: HeatmapPoint[]): number {\n  if (heatmapPoints.length < 2) return 5;\n\n  const lats = heatmapPoints.map((p) => p.lat);\n  const lngs = heatmapPoints.map((p) => p.lng);\n\n  const latRange = Math.max(...lats) - Math.min(...lats);\n  const lngRange = Math.max(...lngs) - Math.min(...lngs);\n\n  const maxRange = Math.max(latRange, lngRange);\n  const radiusKm = (maxRange * 111) / 2;\n\n  return Math.max(2, Math.min(50, radiusKm));\n}\n","path":null,"size_bytes":4873,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { fetchMarineWeather } from \"./marine-api\";\nimport { runMonteCarloSimulation } from \"./drift-engine\";\nimport { setupAuth, isAuthenticated, requireRole } from \"./auth\";\nimport { insertFishermanLocationSchema, insertFishermanProfileSchema } from \"@shared/schema\";\nimport { z } from \"zod\";\n\nconst SIGNAL_LOST_THRESHOLD_MS = 60000;\n\nasync function checkSignalLoss() {\n  const allFishermen = await storage.getAllFishermenWithState();\n  \n  for (const { fisherman, state } of allFishermen) {\n    if (!state || !state.lastUpdateTime) continue;\n    \n    const timeSinceUpdate = Date.now() - new Date(state.lastUpdateTime).getTime();\n    \n    if (timeSinceUpdate > SIGNAL_LOST_THRESHOLD_MS && state.status === \"online\") {\n      await storage.updateFishermanStatus(fisherman.id, \"offline\");\n      \n      await storage.createAlert({\n        fishermanProfileId: fisherman.id,\n        type: \"signal_lost\",\n        message: `GPS signal lost for ${fisherman.fishermanName} (${fisherman.boatName}). Last known location recorded. Drift prediction available.`,\n      });\n    }\n  }\n}\n\nsetInterval(checkSignalLoss, 10000);\n\nexport async function registerRoutes(\n  app: Express\n): Promise<Server> {\n  // Setup authentication (includes /api/auth/register, /api/auth/login, /api/auth/logout, /api/auth/user)\n  await setupAuth(app);\n\n  // Create fisherman profile (for fisherman role)\n  app.post(\"/api/fisherman/profile\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      \n      // Check if profile already exists\n      const existing = await storage.getFishermanProfileByUserId(userId);\n      if (existing) {\n        res.json({ success: true, profile: existing });\n        return;\n      }\n      \n      const validatedData = insertFishermanProfileSchema.parse({\n        ...req.body,\n        userId,\n      });\n      \n      const profile = await storage.createFishermanProfile(validatedData);\n      \n      // Set user role to fisherman\n      await storage.updateUserRole(userId, 'fisherman');\n      \n      res.json({ success: true, profile });\n    } catch (error) {\n      console.error(\"Error creating fisherman profile:\", error);\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ error: \"Invalid data\", details: error.errors });\n      } else {\n        res.status(500).json({ error: \"Failed to create profile\" });\n      }\n    }\n  });\n\n  // Get current fisherman's profile\n  app.get(\"/api/fisherman/profile\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const profile = await storage.getFishermanProfileByUserId(userId);\n      \n      if (!profile) {\n        res.json({ profile: null });\n        return;\n      }\n      \n      const state = await storage.getFishermanState(profile.id);\n      const lastLocation = await storage.getLatestFishermanLocation(profile.id);\n      const activeSession = await storage.getActiveSession(profile.id);\n      \n      res.json({\n        profile,\n        state,\n        lastLocation,\n        activeSession,\n      });\n    } catch (error) {\n      console.error(\"Error getting profile:\", error);\n      res.status(500).json({ error: \"Failed to get profile\" });\n    }\n  });\n\n  // Start sharing location (creates online session)\n  app.post(\"/api/fisherman/start-sharing\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const profile = await storage.getFishermanProfileByUserId(userId);\n      \n      if (!profile) {\n        res.status(404).json({ error: \"Fisherman profile not found\" });\n        return;\n      }\n      \n      const session = await storage.startOnlineSession(profile.id);\n      res.json({ success: true, session });\n    } catch (error) {\n      console.error(\"Error starting sharing:\", error);\n      res.status(500).json({ error: \"Failed to start sharing\" });\n    }\n  });\n\n  // Stop sharing location (ends online session)\n  app.post(\"/api/fisherman/stop-sharing\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const profile = await storage.getFishermanProfileByUserId(userId);\n      \n      if (!profile) {\n        res.status(404).json({ error: \"Fisherman profile not found\" });\n        return;\n      }\n      \n      const activeSession = await storage.getActiveSession(profile.id);\n      if (activeSession) {\n        const lastLocation = await storage.getLatestFishermanLocation(profile.id);\n        if (lastLocation) {\n          await storage.endOnlineSession(activeSession.id, lastLocation.lat, lastLocation.lng);\n        }\n      }\n      \n      await storage.updateFishermanStatus(profile.id, \"offline\");\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error stopping sharing:\", error);\n      res.status(500).json({ error: \"Failed to stop sharing\" });\n    }\n  });\n\n  // Send location update\n  app.post(\"/api/fisherman/location\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const profile = await storage.getFishermanProfileByUserId(userId);\n      \n      if (!profile) {\n        res.status(404).json({ error: \"Fisherman profile not found\" });\n        return;\n      }\n      \n      const activeSession = await storage.getActiveSession(profile.id);\n      \n      const locationSchema = z.object({\n        lat: z.number(),\n        lng: z.number(),\n        source: z.enum([\"gps\", \"pinned\"]).optional().default(\"gps\"),\n        accuracy: z.number().optional(),\n      });\n      \n      const { lat, lng, source, accuracy } = locationSchema.parse(req.body);\n      \n      const validatedData = insertFishermanLocationSchema.parse({\n        fishermanProfileId: profile.id,\n        onlineSessionId: activeSession?.id || null,\n        lat,\n        lng,\n        status: \"online\",\n      });\n      \n      const location = await storage.saveFishermanLocation(validatedData);\n      \n      res.json({ success: true, location, source, accuracy });\n    } catch (error) {\n      console.error(\"Error saving location:\", error);\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ error: \"Invalid location data\", details: error.errors });\n      } else {\n        res.status(500).json({ error: \"Failed to save location\" });\n      }\n    }\n  });\n\n  // Get all fishermen (for coast guard dashboard - requires coastguard role)\n  app.get(\"/api/fishermen\", isAuthenticated, requireRole(\"coastguard\"), async (req: any, res) => {\n    try {\n      const query = req.query.search as string | undefined;\n      const fishermen = query \n        ? await storage.searchFishermenWithState(query)\n        : await storage.getAllFishermenWithState();\n      res.json(fishermen);\n    } catch (error) {\n      console.error(\"Error getting fishermen:\", error);\n      res.status(500).json({ error: \"Failed to get fishermen\" });\n    }\n  });\n\n  // Get fisherman details by ID (for coast guard - requires coastguard role)\n  app.get(\"/api/fisherman/:fishermanProfileId\", isAuthenticated, requireRole(\"coastguard\"), async (req: any, res) => {\n    try {\n      const { fishermanProfileId } = req.params;\n      const profile = await storage.getFishermanProfileById(fishermanProfileId);\n      \n      if (!profile) {\n        res.status(404).json({ error: \"Fisherman not found\" });\n        return;\n      }\n      \n      const state = await storage.getFishermanState(fishermanProfileId);\n      const lastLocation = await storage.getLatestFishermanLocation(fishermanProfileId);\n      const user = await storage.getUser(profile.userId);\n      \n      res.json({\n        profile,\n        user,\n        state: state || null,\n        lastLocation: lastLocation || null,\n      });\n    } catch (error) {\n      console.error(\"Error getting fisherman data:\", error);\n      res.status(500).json({ error: \"Failed to get fisherman data\" });\n    }\n  });\n\n  // Get online session history for a fisherman (requires coastguard role)\n  app.get(\"/api/fisherman/:fishermanProfileId/sessions\", isAuthenticated, requireRole(\"coastguard\"), async (req: any, res) => {\n    try {\n      const { fishermanProfileId } = req.params;\n      const limit = parseInt(req.query.limit as string) || 20;\n      \n      const sessions = await storage.getOnlineSessionHistory(fishermanProfileId, limit);\n      res.json(sessions);\n    } catch (error) {\n      console.error(\"Error getting session history:\", error);\n      res.status(500).json({ error: \"Failed to get session history\" });\n    }\n  });\n\n  // Get last online session (requires coastguard role)\n  app.get(\"/api/fisherman/:fishermanProfileId/last-session\", isAuthenticated, requireRole(\"coastguard\"), async (req: any, res) => {\n    try {\n      const { fishermanProfileId } = req.params;\n      const session = await storage.getLastOnlineSession(fishermanProfileId);\n      res.json(session || null);\n    } catch (error) {\n      console.error(\"Error getting last session:\", error);\n      res.status(500).json({ error: \"Failed to get last session\" });\n    }\n  });\n\n  // Trigger drift mode (for coast guard - requires coastguard role)\n  app.post(\"/api/fisherman/trigger-drift\", isAuthenticated, requireRole(\"coastguard\"), async (req: any, res) => {\n    try {\n      const { fishermanProfileId } = req.body;\n      \n      if (!fishermanProfileId) {\n        res.status(400).json({ error: \"fishermanProfileId is required\" });\n        return;\n      }\n      \n      await storage.updateFishermanStatus(fishermanProfileId, \"offline\");\n      await storage.setFishermanMode(fishermanProfileId, \"drift\");\n      \n      const profile = await storage.getFishermanProfileById(fishermanProfileId);\n      const name = profile ? profile.fishermanName : fishermanProfileId;\n      \n      await storage.createAlert({\n        fishermanProfileId,\n        type: \"signal_lost\",\n        message: `Drift mode triggered manually for ${name}. GPS tracking stopped.`,\n      });\n      \n      res.json({ success: true, message: \"Drift mode activated\" });\n    } catch (error) {\n      console.error(\"Error triggering drift mode:\", error);\n      res.status(500).json({ error: \"Failed to trigger drift mode\" });\n    }\n  });\n\n  // Exit drift mode (for coast guard - requires coastguard role)\n  app.post(\"/api/fisherman/exit-drift\", isAuthenticated, requireRole(\"coastguard\"), async (req: any, res) => {\n    try {\n      const { fishermanProfileId } = req.body;\n      \n      if (!fishermanProfileId) {\n        res.status(400).json({ error: \"fishermanProfileId is required\" });\n        return;\n      }\n      \n      await storage.setFishermanMode(fishermanProfileId, \"live\");\n      \n      const profile = await storage.getFishermanProfileById(fishermanProfileId);\n      const name = profile ? profile.fishermanName : fishermanProfileId;\n      \n      await storage.createAlert({\n        fishermanProfileId,\n        type: \"mode_change\",\n        message: `Drift mode exited for ${name}. Awaiting GPS signal.`,\n      });\n      \n      res.json({ success: true, message: \"Drift mode exited\" });\n    } catch (error) {\n      console.error(\"Error exiting drift mode:\", error);\n      res.status(500).json({ error: \"Failed to exit drift mode\" });\n    }\n  });\n\n  // Marine weather\n  app.get(\"/api/marine-weather\", async (req, res) => {\n    try {\n      const lat = parseFloat(req.query.lat as string);\n      const lng = parseFloat(req.query.lng as string);\n      \n      if (isNaN(lat) || isNaN(lng)) {\n        res.status(400).json({ error: \"Valid lat and lng query parameters are required\" });\n        return;\n      }\n      \n      const weather = await fetchMarineWeather(lat, lng);\n      res.json(weather);\n    } catch (error) {\n      console.error(\"Error fetching marine weather:\", error);\n      res.status(500).json({ error: \"Failed to fetch marine weather\" });\n    }\n  });\n\n  // Run drift simulation (requires coastguard role)\n  app.post(\"/api/simulation/run\", isAuthenticated, requireRole(\"coastguard\"), async (req: any, res) => {\n    try {\n      const schema = z.object({\n        fishermanProfileId: z.string(),\n        lastKnownLat: z.number(),\n        lastKnownLng: z.number(),\n        simulationHours: z.number().min(1).max(12),\n        numPaths: z.number().min(10).max(200).default(100),\n        onlineSessionId: z.string().optional(),\n      });\n      \n      const { fishermanProfileId, lastKnownLat, lastKnownLng, simulationHours, numPaths, onlineSessionId } = \n        schema.parse(req.body);\n      \n      const weather = await fetchMarineWeather(lastKnownLat, lastKnownLng);\n      \n      const result = runMonteCarloSimulation(\n        lastKnownLat,\n        lastKnownLng,\n        weather,\n        simulationHours,\n        numPaths\n      );\n      \n      const driftResult = await storage.saveDriftResult({\n        fishermanProfileId,\n        onlineSessionId: onlineSessionId || null,\n        simulationHours,\n        predictedPoints: result.predictedPoints,\n        heatmapPoints: result.heatmapPoints,\n        driftPaths: result.driftPaths,\n      });\n      \n      await storage.createAlert({\n        fishermanProfileId,\n        type: \"drift_complete\",\n        message: `Drift simulation complete. Generated ${numPaths} paths over ${simulationHours} hours. Search area calculated.`,\n      });\n      \n      res.json({\n        success: true,\n        result: driftResult,\n        weather,\n      });\n    } catch (error) {\n      console.error(\"Error running simulation:\", error);\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ error: \"Invalid simulation parameters\", details: error.errors });\n      } else {\n        res.status(500).json({ error: \"Failed to run simulation\" });\n      }\n    }\n  });\n\n  // Get drift result (requires coastguard role)\n  app.get(\"/api/drift-result/:fishermanProfileId\", isAuthenticated, requireRole(\"coastguard\"), async (req: any, res) => {\n    try {\n      const { fishermanProfileId } = req.params;\n      const result = await storage.getLatestDriftResult(fishermanProfileId);\n      \n      if (!result) {\n        res.json(null);\n        return;\n      }\n      \n      res.json(result);\n    } catch (error) {\n      console.error(\"Error getting drift result:\", error);\n      res.status(500).json({ error: \"Failed to get drift result\" });\n    }\n  });\n\n  // Get drift result by session (requires coastguard role)\n  app.get(\"/api/drift-result/session/:onlineSessionId\", isAuthenticated, requireRole(\"coastguard\"), async (req: any, res) => {\n    try {\n      const { onlineSessionId } = req.params;\n      const result = await storage.getDriftResultBySession(onlineSessionId);\n      res.json(result || null);\n    } catch (error) {\n      console.error(\"Error getting drift result:\", error);\n      res.status(500).json({ error: \"Failed to get drift result\" });\n    }\n  });\n\n  // Alerts (requires coastguard role)\n  app.get(\"/api/alerts\", isAuthenticated, requireRole(\"coastguard\"), async (req: any, res) => {\n    try {\n      const fishermanProfileId = req.query.fishermanProfileId as string | undefined;\n      const alerts = await storage.getAlerts(fishermanProfileId);\n      res.json(alerts);\n    } catch (error) {\n      console.error(\"Error getting alerts:\", error);\n      res.status(500).json({ error: \"Failed to get alerts\" });\n    }\n  });\n\n  app.patch(\"/api/alerts/:alertId/dismiss\", isAuthenticated, requireRole(\"coastguard\"), async (req: any, res) => {\n    try {\n      const { alertId } = req.params;\n      await storage.dismissAlert(alertId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error dismissing alert:\", error);\n      res.status(500).json({ error: \"Failed to dismiss alert\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","path":null,"size_bytes":15701,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/map/leaflet-map.tsx":{"content":"import { useEffect, useRef, useState } from \"react\";\nimport L from \"leaflet\";\nimport \"leaflet/dist/leaflet.css\";\n\ninterface MapMarker {\n  lat: number;\n  lng: number;\n  type: \"live\" | \"lastKnown\" | \"predicted\" | \"pinned\";\n  popup?: string;\n  accuracy?: number;\n}\n\ninterface DriftPath {\n  points: { lat: number; lng: number }[];\n  color?: string;\n}\n\ninterface HeatmapPoint {\n  lat: number;\n  lng: number;\n  intensity: number;\n}\n\ninterface LeafletMapProps {\n  center?: [number, number];\n  zoom?: number;\n  markers?: MapMarker[];\n  driftPaths?: DriftPath[];\n  heatmapPoints?: HeatmapPoint[];\n  showHeatmap?: boolean;\n  showPaths?: boolean;\n  className?: string;\n  onMapReady?: (map: L.Map) => void;\n  onMapClick?: (lat: number, lng: number) => void;\n  allowClick?: boolean;\n}\n\nconst defaultIcon = L.divIcon({\n  className: \"custom-marker\",\n  html: `<div class=\"w-6 h-6 bg-live rounded-full border-2 border-white shadow-lg animate-pulse\"></div>`,\n  iconSize: [24, 24],\n  iconAnchor: [12, 12],\n});\n\nconst lastKnownIcon = L.divIcon({\n  className: \"custom-marker\",\n  html: `<div class=\"w-6 h-6 bg-drift rounded-full border-2 border-white shadow-lg opacity-80\"></div>`,\n  iconSize: [24, 24],\n  iconAnchor: [12, 12],\n});\n\nconst predictedIcon = L.divIcon({\n  className: \"custom-marker\",\n  html: `<div class=\"w-4 h-4 bg-danger rounded-full border-2 border-white shadow-md opacity-60\"></div>`,\n  iconSize: [16, 16],\n  iconAnchor: [8, 8],\n});\n\nconst pinnedIcon = L.divIcon({\n  className: \"custom-marker\",\n  html: `<div class=\"w-6 h-6 bg-ocean rounded-full border-2 border-white shadow-lg flex items-center justify-center\"><div class=\"w-2 h-2 bg-white rounded-full\"></div></div>`,\n  iconSize: [24, 24],\n  iconAnchor: [12, 12],\n});\n\nexport function LeafletMap({\n  center = [13.0827, 80.2707],\n  zoom = 10,\n  markers = [],\n  driftPaths = [],\n  heatmapPoints = [],\n  showHeatmap = true,\n  showPaths = true,\n  className = \"\",\n  onMapReady,\n  onMapClick,\n  allowClick = false,\n}: LeafletMapProps) {\n  const mapRef = useRef<L.Map | null>(null);\n  const mapContainerRef = useRef<HTMLDivElement>(null);\n  const markersLayerRef = useRef<L.LayerGroup | null>(null);\n  const pathsLayerRef = useRef<L.LayerGroup | null>(null);\n  const heatmapLayerRef = useRef<L.LayerGroup | null>(null);\n  const [isInitialized, setIsInitialized] = useState(false);\n\n  useEffect(() => {\n    if (!mapContainerRef.current || mapRef.current) return;\n\n    const map = L.map(mapContainerRef.current, {\n      center,\n      zoom,\n      zoomControl: true,\n      attributionControl: true,\n    });\n\n    L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n      maxZoom: 19,\n    }).addTo(map);\n\n    markersLayerRef.current = L.layerGroup().addTo(map);\n    pathsLayerRef.current = L.layerGroup().addTo(map);\n    heatmapLayerRef.current = L.layerGroup().addTo(map);\n\n    mapRef.current = map;\n    setIsInitialized(true);\n\n    if (onMapReady) {\n      onMapReady(map);\n    }\n\n    return () => {\n      map.remove();\n      mapRef.current = null;\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!mapRef.current || !isInitialized) return;\n\n    const handleClick = (e: L.LeafletMouseEvent) => {\n      if (allowClick && onMapClick) {\n        onMapClick(e.latlng.lat, e.latlng.lng);\n      }\n    };\n\n    mapRef.current.on('click', handleClick);\n\n    return () => {\n      mapRef.current?.off('click', handleClick);\n    };\n  }, [allowClick, onMapClick, isInitialized]);\n\n  useEffect(() => {\n    if (!isInitialized || !markersLayerRef.current) return;\n\n    markersLayerRef.current.clearLayers();\n\n    markers.forEach((marker) => {\n      let icon;\n      switch (marker.type) {\n        case \"live\":\n          icon = defaultIcon;\n          break;\n        case \"lastKnown\":\n          icon = lastKnownIcon;\n          break;\n        case \"pinned\":\n          icon = pinnedIcon;\n          break;\n        default:\n          icon = predictedIcon;\n      }\n\n      const leafletMarker = L.marker([marker.lat, marker.lng], { icon });\n\n      if (marker.popup) {\n        leafletMarker.bindPopup(marker.popup);\n      }\n\n      markersLayerRef.current?.addLayer(leafletMarker);\n\n      if (marker.accuracy && marker.accuracy > 0 && marker.type === \"live\") {\n        const accuracyCircle = L.circle([marker.lat, marker.lng], {\n          radius: marker.accuracy,\n          color: '#22c55e',\n          fillColor: '#22c55e',\n          fillOpacity: 0.1,\n          weight: 1,\n        });\n        markersLayerRef.current?.addLayer(accuracyCircle);\n      }\n    });\n  }, [markers, isInitialized]);\n\n  useEffect(() => {\n    if (!isInitialized || !pathsLayerRef.current) return;\n\n    pathsLayerRef.current.clearLayers();\n\n    if (!showPaths) return;\n\n    driftPaths.forEach((path, index) => {\n      if (path.points.length < 2) return;\n\n      const latLngs = path.points.map((p) => [p.lat, p.lng] as [number, number]);\n      const polyline = L.polyline(latLngs, {\n        color: path.color || `hsl(${(index * 30) % 360}, 70%, 50%)`,\n        weight: 2,\n        opacity: 0.6,\n        dashArray: \"5, 5\",\n      });\n\n      pathsLayerRef.current?.addLayer(polyline);\n    });\n  }, [driftPaths, showPaths, isInitialized]);\n\n  useEffect(() => {\n    if (!isInitialized || !heatmapLayerRef.current) return;\n\n    heatmapLayerRef.current.clearLayers();\n\n    if (!showHeatmap || heatmapPoints.length === 0) return;\n\n    heatmapPoints.forEach((point) => {\n      const intensity = Math.min(1, Math.max(0.2, point.intensity));\n      const radius = 8 + intensity * 12;\n      const opacity = 0.3 + intensity * 0.4;\n\n      const circle = L.circleMarker([point.lat, point.lng], {\n        radius,\n        fillColor: `rgb(245, ${Math.floor(158 - intensity * 100)}, ${Math.floor(11 + intensity * 50)})`,\n        fillOpacity: opacity,\n        stroke: false,\n      });\n\n      heatmapLayerRef.current?.addLayer(circle);\n    });\n  }, [heatmapPoints, showHeatmap, isInitialized]);\n\n  useEffect(() => {\n    if (!mapRef.current || !isInitialized) return;\n\n    if (markers.length > 0) {\n      const liveMarker = markers.find((m) => m.type === \"live\");\n      if (liveMarker) {\n        mapRef.current.setView([liveMarker.lat, liveMarker.lng], mapRef.current.getZoom());\n      }\n    }\n  }, [markers, isInitialized]);\n\n  return (\n    <div\n      ref={mapContainerRef}\n      className={`w-full h-full min-h-[200px] ${className}`}\n      data-testid=\"map-container\"\n    />\n  );\n}\n","path":null,"size_bytes":6448,"size_tokens":null},"client/src/hooks/use-geolocation.ts":{"content":"import { useState, useEffect, useCallback, useRef } from \"react\";\n\nexport interface GeolocationState {\n  latitude: number | null;\n  longitude: number | null;\n  accuracy: number | null;\n  altitude: number | null;\n  heading: number | null;\n  speed: number | null;\n  error: string | null;\n  isTracking: boolean;\n  lastUpdate: Date | null;\n  accuracyLevel: \"high\" | \"medium\" | \"low\" | null;\n  isAcquiring: boolean;\n}\n\nfunction getAccuracyLevel(accuracy: number | null): \"high\" | \"medium\" | \"low\" | null {\n  if (accuracy === null) return null;\n  if (accuracy <= 20) return \"high\";\n  if (accuracy <= 100) return \"medium\";\n  return \"low\";\n}\n\nexport function useGeolocation(options?: PositionOptions) {\n  const [state, setState] = useState<GeolocationState>({\n    latitude: null,\n    longitude: null,\n    accuracy: null,\n    altitude: null,\n    heading: null,\n    speed: null,\n    error: null,\n    isTracking: false,\n    lastUpdate: null,\n    accuracyLevel: null,\n    isAcquiring: false,\n  });\n\n  const watchIdRef = useRef<number | null>(null);\n  const retryCountRef = useRef(0);\n  const maxRetries = 3;\n\n  const startTracking = useCallback(() => {\n    if (!navigator.geolocation) {\n      setState((prev) => ({\n        ...prev,\n        error: \"Geolocation is not supported by your browser\",\n      }));\n      return;\n    }\n\n    setState((prev) => ({ ...prev, isTracking: true, isAcquiring: true, error: null }));\n    retryCountRef.current = 0;\n\n    const handleSuccess = (position: GeolocationPosition) => {\n      const coords = position.coords;\n      const currentAccuracy = coords.accuracy;\n      \n      setState({\n        latitude: coords.latitude,\n        longitude: coords.longitude,\n        accuracy: currentAccuracy,\n        altitude: coords.altitude,\n        heading: coords.heading,\n        speed: coords.speed,\n        error: null,\n        isTracking: true,\n        lastUpdate: new Date(),\n        accuracyLevel: getAccuracyLevel(currentAccuracy),\n        isAcquiring: false,\n      });\n      \n      retryCountRef.current = 0;\n    };\n\n    const handleError = (error: GeolocationPositionError) => {\n      let errorMessage: string;\n      switch (error.code) {\n        case error.PERMISSION_DENIED:\n          errorMessage = \"Location permission denied. Please enable GPS access in your browser settings.\";\n          break;\n        case error.POSITION_UNAVAILABLE:\n          errorMessage = \"Location unavailable. Please ensure GPS is enabled on your device.\";\n          break;\n        case error.TIMEOUT:\n          if (retryCountRef.current < maxRetries) {\n            retryCountRef.current++;\n            return;\n          }\n          errorMessage = \"Location request timed out. Please check your GPS signal.\";\n          break;\n        default:\n          errorMessage = \"An unknown error occurred while getting location.\";\n      }\n      setState((prev) => ({\n        ...prev,\n        error: errorMessage,\n        isTracking: false,\n        isAcquiring: false,\n      }));\n    };\n\n    const defaultOptions: PositionOptions = {\n      enableHighAccuracy: true,\n      timeout: 15000,\n      maximumAge: 0,\n      ...options,\n    };\n\n    navigator.geolocation.getCurrentPosition(\n      (position) => {\n        handleSuccess(position);\n        \n        watchIdRef.current = navigator.geolocation.watchPosition(\n          handleSuccess,\n          handleError,\n          defaultOptions\n        );\n      },\n      (error) => {\n        watchIdRef.current = navigator.geolocation.watchPosition(\n          handleSuccess,\n          handleError,\n          defaultOptions\n        );\n      },\n      { ...defaultOptions, timeout: 10000 }\n    );\n  }, [options]);\n\n  const stopTracking = useCallback(() => {\n    if (watchIdRef.current !== null) {\n      navigator.geolocation.clearWatch(watchIdRef.current);\n      watchIdRef.current = null;\n    }\n    setState((prev) => ({ ...prev, isTracking: false, isAcquiring: false }));\n  }, []);\n\n  const clearLocation = useCallback(() => {\n    setState((prev) => ({\n      ...prev,\n      latitude: null,\n      longitude: null,\n      accuracy: null,\n      altitude: null,\n      heading: null,\n      speed: null,\n      lastUpdate: null,\n      accuracyLevel: null,\n    }));\n  }, []);\n\n  useEffect(() => {\n    return () => {\n      if (watchIdRef.current !== null) {\n        navigator.geolocation.clearWatch(watchIdRef.current);\n      }\n    };\n  }, []);\n\n  return {\n    ...state,\n    startTracking,\n    stopTracking,\n    clearLocation,\n  };\n}\n","path":null,"size_bytes":4450,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 210 5% 98%;\n  --foreground: 210 8% 12%;\n  --border: 210 6% 88%;\n  --card: 210 5% 96%;\n  --card-foreground: 210 8% 12%;\n  --card-border: 210 6% 92%;\n  --sidebar: 210 5% 94%;\n  --sidebar-foreground: 210 8% 15%;\n  --sidebar-border: 210 6% 89%;\n  --sidebar-primary: 207 85% 42%;\n  --sidebar-primary-foreground: 207 20% 98%;\n  --sidebar-accent: 210 8% 88%;\n  --sidebar-accent-foreground: 210 8% 15%;\n  --sidebar-ring: 207 85% 42%;\n  --popover: 210 6% 92%;\n  --popover-foreground: 210 8% 15%;\n  --popover-border: 210 6% 86%;\n  --primary: 207 85% 42%;\n  --primary-foreground: 207 20% 98%;\n  --secondary: 210 8% 88%;\n  --secondary-foreground: 210 8% 15%;\n  --muted: 210 8% 90%;\n  --muted-foreground: 210 6% 35%;\n  --accent: 210 12% 89%;\n  --accent-foreground: 210 8% 18%;\n  --destructive: 0 72% 45%;\n  --destructive-foreground: 0 15% 98%;\n  --input: 210 8% 75%;\n  --ring: 207 85% 42%;\n  --chart-1: 207 85% 42%;\n  --chart-2: 197 75% 38%;\n  --chart-3: 187 68% 35%;\n  --chart-4: 177 62% 32%;\n  --chart-5: 167 58% 30%;\n  --font-sans: Open Sans, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(210 8% 15% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(210 8% 15% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(210 8% 15% / 0.00), 0px 1px 2px -1px hsl(210 8% 15% / 0.06);\n  --shadow: 0px 2px 0px 0px hsl(210 8% 15% / 0.00), 0px 1px 2px -1px hsl(210 8% 15% / 0.08);\n  --shadow-md: 0px 2px 0px 0px hsl(210 8% 15% / 0.00), 0px 2px 4px -1px hsl(210 8% 15% / 0.10);\n  --shadow-lg: 0px 2px 0px 0px hsl(210 8% 15% / 0.00), 0px 4px 6px -1px hsl(210 8% 15% / 0.12);\n  --shadow-xl: 0px 2px 0px 0px hsl(210 8% 15% / 0.00), 0px 8px 10px -1px hsl(210 8% 15% / 0.14);\n  --shadow-2xl: 0px 2px 0px 0px hsl(210 8% 15% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 210 5% 8%;\n  --foreground: 210 8% 92%;\n  --border: 210 6% 16%;\n  --card: 210 5% 10%;\n  --card-foreground: 210 8% 92%;\n  --card-border: 210 6% 12%;\n  --sidebar: 210 5% 12%;\n  --sidebar-foreground: 210 8% 88%;\n  --sidebar-border: 210 6% 15%;\n  --sidebar-primary: 207 85% 48%;\n  --sidebar-primary-foreground: 207 20% 98%;\n  --sidebar-accent: 210 8% 16%;\n  --sidebar-accent-foreground: 210 8% 88%;\n  --sidebar-ring: 207 85% 48%;\n  --popover: 210 6% 14%;\n  --popover-foreground: 210 8% 88%;\n  --popover-border: 210 6% 18%;\n  --primary: 207 85% 48%;\n  --primary-foreground: 207 20% 98%;\n  --secondary: 210 8% 18%;\n  --secondary-foreground: 210 8% 88%;\n  --muted: 210 8% 16%;\n  --muted-foreground: 210 6% 65%;\n  --accent: 210 12% 17%;\n  --accent-foreground: 210 8% 85%;\n  --destructive: 0 72% 45%;\n  --destructive-foreground: 0 15% 98%;\n  --input: 210 8% 28%;\n  --ring: 207 85% 48%;\n  --chart-1: 207 85% 58%;\n  --chart-2: 197 75% 62%;\n  --chart-3: 187 68% 65%;\n  --chart-4: 177 62% 68%;\n  --chart-5: 167 58% 70%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(210 8% 88% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(210 8% 88% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(210 8% 88% / 0.00), 0px 1px 2px -1px hsl(210 8% 88% / 0.06);\n  --shadow: 0px 2px 0px 0px hsl(210 8% 88% / 0.00), 0px 1px 2px -1px hsl(210 8% 88% / 0.08);\n  --shadow-md: 0px 2px 0px 0px hsl(210 8% 88% / 0.00), 0px 2px 4px -1px hsl(210 8% 88% / 0.10);\n  --shadow-lg: 0px 2px 0px 0px hsl(210 8% 88% / 0.00), 0px 4px 6px -1px hsl(210 8% 88% / 0.12);\n  --shadow-xl: 0px 2px 0px 0px hsl(210 8% 88% / 0.00), 0px 8px 10px -1px hsl(210 8% 88% / 0.14);\n  --shadow-2xl: 0px 2px 0px 0px hsl(210 8% 88% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n\n  .leaflet-container {\n    width: 100%;\n    height: 100%;\n    z-index: 0;\n  }\n\n  .custom-marker {\n    background: transparent;\n    border: none;\n  }\n\n  .leaflet-popup-content-wrapper {\n    @apply bg-card text-card-foreground rounded-lg shadow-lg;\n  }\n\n  .leaflet-popup-tip {\n    @apply bg-card;\n  }\n}\n\n@keyframes pulse-ring {\n  0% {\n    transform: scale(1);\n    opacity: 1;\n  }\n  100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":11145,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/coordinate-display.tsx":{"content":"import { Copy, Check } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface CoordinateDisplayProps {\n  lat: number | null;\n  lng: number | null;\n  label?: string;\n  showCopy?: boolean;\n  className?: string;\n}\n\nexport function CoordinateDisplay({\n  lat,\n  lng,\n  label = \"Coordinates\",\n  showCopy = true,\n  className = \"\",\n}: CoordinateDisplayProps) {\n  const [copied, setCopied] = useState(false);\n  const { toast } = useToast();\n\n  const formatCoord = (value: number | null, isLat: boolean) => {\n    if (value === null) return \"â€”\";\n    const direction = isLat ? (value >= 0 ? \"N\" : \"S\") : value >= 0 ? \"E\" : \"W\";\n    return `${Math.abs(value).toFixed(6)}Â° ${direction}`;\n  };\n\n  const handleCopy = async () => {\n    if (lat === null || lng === null) return;\n\n    const text = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;\n    await navigator.clipboard.writeText(text);\n    setCopied(true);\n    toast({\n      title: \"Coordinates copied\",\n      description: text,\n    });\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  return (\n    <div className={`space-y-2 ${className}`}>\n      {(label || showCopy) && (\n        <div className=\"flex items-center justify-between gap-4\">\n          {label && <span className=\"text-sm font-medium text-muted-foreground\">{label}</span>}\n          {showCopy && lat !== null && lng !== null && (\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-8 w-8 ml-auto\"\n              onClick={handleCopy}\n              data-testid=\"button-copy-coordinates\"\n            >\n              {copied ? (\n                <Check className=\"h-4 w-4 text-live\" />\n              ) : (\n                <Copy className=\"h-4 w-4\" />\n              )}\n            </Button>\n          )}\n        </div>\n      )}\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div className=\"space-y-1\">\n          <span className=\"text-xs text-muted-foreground\">Latitude</span>\n          <p\n            className=\"text-xl font-mono font-medium tabular-nums\"\n            data-testid=\"text-latitude\"\n          >\n            {formatCoord(lat, true)}\n          </p>\n        </div>\n        <div className=\"space-y-1\">\n          <span className=\"text-xs text-muted-foreground\">Longitude</span>\n          <p\n            className=\"text-xl font-mono font-medium tabular-nums\"\n            data-testid=\"text-longitude\"\n          >\n            {formatCoord(lng, false)}\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":2578,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n        live: {\n          DEFAULT: \"rgb(34 197 94)\",\n          foreground: \"rgb(255 255 255)\",\n          muted: \"rgb(187 247 208)\",\n        },\n        drift: {\n          DEFAULT: \"rgb(245 158 11)\",\n          foreground: \"rgb(255 255 255)\",\n          muted: \"rgb(254 243 199)\",\n        },\n        danger: {\n          DEFAULT: \"rgb(239 68 68)\",\n          foreground: \"rgb(255 255 255)\",\n          muted: \"rgb(254 226 226)\",\n        },\n        ocean: {\n          DEFAULT: \"rgb(14 165 233)\",\n          dark: \"rgb(2 132 199)\",\n          light: \"rgb(186 230 253)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4620,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/simulation-controls.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Play, Loader2, Map, Route } from \"lucide-react\";\n\ninterface SimulationControlsProps {\n  hours: number;\n  onHoursChange: (hours: number) => void;\n  showHeatmap: boolean;\n  onShowHeatmapChange: (show: boolean) => void;\n  showPaths: boolean;\n  onShowPathsChange: (show: boolean) => void;\n  onRunSimulation: () => void;\n  isSimulating?: boolean;\n  canSimulate?: boolean;\n  className?: string;\n}\n\nexport function SimulationControls({\n  hours,\n  onHoursChange,\n  showHeatmap,\n  onShowHeatmapChange,\n  showPaths,\n  onShowPathsChange,\n  onRunSimulation,\n  isSimulating = false,\n  canSimulate = true,\n  className = \"\",\n}: SimulationControlsProps) {\n  return (\n    <Card className={className}>\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-base font-semibold\">Drift Simulation</CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <Label htmlFor=\"simulation-hours\" className=\"text-sm font-medium\">\n              Simulation Period\n            </Label>\n            <span className=\"text-2xl font-bold text-primary\" data-testid=\"text-simulation-hours\">\n              {hours}h\n            </span>\n          </div>\n          <Slider\n            id=\"simulation-hours\"\n            min={1}\n            max={12}\n            step={1}\n            value={[hours]}\n            onValueChange={([value]) => onHoursChange(value)}\n            className=\"w-full\"\n            data-testid=\"slider-simulation-hours\"\n          />\n          <div className=\"flex justify-between text-xs text-muted-foreground\">\n            <span>1 hour</span>\n            <span>6 hours</span>\n            <span>12 hours</span>\n          </div>\n        </div>\n\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Map className=\"h-4 w-4 text-muted-foreground\" />\n              <Label htmlFor=\"show-heatmap\" className=\"text-sm\">\n                Show Heatmap\n              </Label>\n            </div>\n            <Switch\n              id=\"show-heatmap\"\n              checked={showHeatmap}\n              onCheckedChange={onShowHeatmapChange}\n              data-testid=\"switch-show-heatmap\"\n            />\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Route className=\"h-4 w-4 text-muted-foreground\" />\n              <Label htmlFor=\"show-paths\" className=\"text-sm\">\n                Show Drift Paths\n              </Label>\n            </div>\n            <Switch\n              id=\"show-paths\"\n              checked={showPaths}\n              onCheckedChange={onShowPathsChange}\n              data-testid=\"switch-show-paths\"\n            />\n          </div>\n        </div>\n\n        <Button\n          className=\"w-full h-11\"\n          onClick={onRunSimulation}\n          disabled={!canSimulate || isSimulating}\n          data-testid=\"button-run-simulation\"\n        >\n          {isSimulating ? (\n            <>\n              <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n              Simulating...\n            </>\n          ) : (\n            <>\n              <Play className=\"h-4 w-4 mr-2\" />\n              Run Drift Simulation\n            </>\n          )}\n        </Button>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":3712,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport Landing from \"@/pages/landing\";\nimport FishermanSetup from \"@/pages/fisherman-setup\";\nimport FishermanApp from \"@/pages/fisherman-app\";\nimport Dashboard from \"@/pages/dashboard\";\nimport NotFound from \"@/pages/not-found\";\nimport { Loader2 } from \"lucide-react\";\n\nfunction AuthenticatedRouter() {\n  const { user, isLoading, isAuthenticated, isFisherman, isCoastGuard, hasFishermanProfile } = useAuth();\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-ocean mx-auto mb-4\" />\n          <p className=\"text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return <Landing />;\n  }\n\n  // Coast Guard users go directly to dashboard\n  if (isCoastGuard) {\n    return (\n      <Switch>\n        <Route path=\"/\" component={Dashboard} />\n        <Route path=\"/dashboard\" component={Dashboard} />\n        <Route component={NotFound} />\n      </Switch>\n    );\n  }\n\n  // Fisherman users with profile go to fisherman app\n  if (isFisherman && hasFishermanProfile) {\n    return (\n      <Switch>\n        <Route path=\"/\" component={FishermanApp} />\n        <Route path=\"/fisherman\" component={FishermanApp} />\n        <Route component={NotFound} />\n      </Switch>\n    );\n  }\n\n  // Fisherman users without profile need to complete setup\n  if (isFisherman && !hasFishermanProfile) {\n    return (\n      <Switch>\n        <Route path=\"/\" component={FishermanSetup} />\n        <Route path=\"/setup\" component={FishermanSetup} />\n        <Route component={NotFound} />\n      </Switch>\n    );\n  }\n\n  // Fallback\n  return <NotFound />;\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <AuthenticatedRouter />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":2264,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"design_guidelines.md":{"content":"# CoastGuard Lite Design Guidelines\n\n## Design Approach\n\n**System Selected:** Material Design principles adapted for emergency services\n**Rationale:** Life-safety application requiring maximum clarity, strong visual feedback, and clear state differentiation. Functionality and quick comprehension take absolute priority.\n\n**Core Principles:**\n- **Clarity First:** Every element must communicate its purpose instantly\n- **State Visibility:** LIVE vs DRIFT modes must be unmistakable at a glance\n- **Touch-Optimized:** Large tap targets (minimum 48px) for mobile/stress situations\n- **Information Hierarchy:** Critical data (coordinates, status, time) always prominent\n\n---\n\n## Typography\n\n**Font Stack:** System fonts for maximum performance and clarity\n- Primary: `-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif`\n\n**Hierarchy:**\n- **Display (Status/Mode):** 2.5rem (40px), Bold, tracking-tight - LIVE MODE/DRIFT MODE headers\n- **Heading:** 1.5rem (24px), Semibold - Section titles, panel headers\n- **Body Large:** 1.125rem (18px), Medium - Coordinates, timestamps, primary data\n- **Body:** 1rem (16px), Regular - Descriptive text, labels\n- **Small:** 0.875rem (14px), Medium - Metadata, supplementary info\n\n**Key Rules:**\n- Status indicators use all-caps for emphasis\n- Coordinates always use monospace variant for alignment: `font-variant-numeric: tabular-nums`\n- Critical alerts use bold weight exclusively\n\n---\n\n## Layout System\n\n**Spacing Scale:** Tailwind units of **2, 4, 6, 8, 12, 16**\n- Tight spacing: `p-2, gap-2` - Within components\n- Standard: `p-4, gap-4, m-4` - Component padding, card spacing\n- Comfortable: `p-6, gap-6` - Section padding\n- Generous: `p-8, m-8` - Major section separation\n- Extra: `p-12, p-16` - Dashboard panel margins\n\n**Grid Structure:**\n- **Fisherman App:** Single column, full viewport utilization\n- **Dashboard:** Sidebar (320px fixed) + Map (flex-1) layout on desktop, stack on mobile\n\n---\n\n## Component Library\n\n### Fisherman Mobile App Components\n\n**Primary Action Button:**\n- Full-width or near-full-width (max-w-sm centered)\n- Height: `h-14` (56px)\n- Border radius: `rounded-xl`\n- Typography: `text-lg font-semibold`\n- States: Clear pressed/disabled states with opacity shifts\n\n**Status Indicator:**\n- Large badge component at top of screen\n- Height: `h-16` with `px-6`\n- Includes icon (signal indicator) + status text\n- Border radius: `rounded-full`\n- Uses status-specific styling (connected/disconnected)\n\n**Map Preview Card:**\n- Height: `h-64` for embedded map\n- Border radius: `rounded-2xl`\n- Shadow: `shadow-lg`\n\n### Coast Guard Dashboard Components\n\n**Map Container:**\n- Full viewport height minus header: `h-[calc(100vh-4rem)]`\n- No border radius - edge-to-edge for maximum screen real estate\n\n**Control Panel Sidebar:**\n- Fixed width: `w-80` (320px)\n- Scrollable content: `overflow-y-auto`\n- Sections separated by `gap-6`\n\n**Data Display Cards:**\n- Border radius: `rounded-lg`\n- Padding: `p-4` to `p-6`\n- Border: `border-2` with status-dependent treatment\n- Shadow: `shadow-md`\n\n**Coordinate Display:**\n- Monospace-style presentation\n- Large text: `text-xl`\n- Label above value pattern\n- Copy button adjacent\n\n**Mode Badge (LIVE/DRIFT):**\n- Position: Fixed top-right or within panel header\n- Height: `h-10`\n- Padding: `px-6`\n- Border radius: `rounded-full`\n- Typography: `text-sm font-bold uppercase tracking-wide`\n\n**Control Buttons:**\n- Height: `h-11` (44px)\n- Full-width within panel\n- Border radius: `rounded-lg`\n- Icon + label combination\n\n**Hour Slider:**\n- Range input with labels\n- Visible tick marks\n- Large thumb for easy grabbing\n- Current value displayed prominently above\n\n**Toggle Controls (Heatmap/Paths):**\n- Switch component pattern\n- Height: `h-6`, width: `w-11`\n- Label adjacent with `gap-3`\n\n### Alert Components\n\n**Alert Banner:**\n- Full-width at top of dashboard\n- Height: `h-12` minimum\n- Border-left accent: `border-l-4`\n- Icon + message + dismiss button\n- Slide-in animation from top\n\n**Toast Notification:**\n- Fixed positioning: bottom-right\n- Max-width: `max-w-sm`\n- Border radius: `rounded-lg`\n- Shadow: `shadow-xl`\n- Auto-dismiss after 5 seconds\n\n---\n\n## Map Visualization\n\n**Markers:**\n- Live GPS: Pulsing marker, large size (24px icon)\n- Last Known: Distinct icon, semi-transparent\n- Drift Paths: Polylines with arrow decorators\n\n**Heatmap:**\n- Gradient intensity from low to high probability\n- Adjustable opacity (50-80% range)\n- Toggle on/off without removing data\n\n**Legend:**\n- Positioned bottom-left of map\n- Compact: `p-3`\n- Background with blur effect: `backdrop-blur-sm`\n- Border radius: `rounded-lg`\n\n---\n\n## Responsive Behavior\n\n**Fisherman App Breakpoints:**\n- Base (mobile): Single column, full-width controls\n- All sizes: Maintain same layout (mobile-first only)\n\n**Dashboard Breakpoints:**\n- Mobile/Tablet (`<1024px`): Stack sidebar above map, collapsible\n- Desktop (`>=1024px`): Side-by-side, fixed sidebar\n\n**Map Responsiveness:**\n- Mobile: Full viewport, floating control buttons\n- Desktop: Contained within layout grid\n\n---\n\n## Interaction Patterns\n\n**GPS Start/Stop:**\n- Single large button toggles between states\n- Text changes: \"Start Sharing My Location\" â†” \"Stop Sharing\"\n- Visual feedback: Button transforms during active state\n\n**Dashboard Refresh:**\n- Manual refresh button with loading spinner\n- Auto-refresh toggle with interval display\n\n**Drift Trigger:**\n- Automatic on signal loss\n- Manual override button available\n- Confirmation modal for manual trigger\n\n**Data Updates:**\n- Smooth transitions for coordinate changes\n- Fade-in for new drift paths\n- Pulse animation for heatmap updates\n\n---\n\n## Accessibility\n\n- All interactive elements: minimum 44px touch target\n- High contrast ratios: 4.5:1 minimum for all text\n- Focus indicators: `ring-2 ring-offset-2` on all controls\n- Screen reader labels for map controls and status indicators\n- Keyboard navigation: Full support for dashboard controls\n\n---\n\n## Images\n\n**Not Applicable** - This is a functional utility dashboard. All visual content is map-based (Leaflet rendered) and data-driven. No decorative or hero images needed. The interface is purely functional with maps, charts, and real-time data visualization.","path":null,"size_bytes":6198,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/pages/fisherman-app.tsx":{"content":"import { useState, useEffect, useCallback, useRef } from \"react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useGeolocation } from \"@/hooks/use-geolocation\";\nimport { ConnectionBadge } from \"@/components/status-badge\";\nimport { CoordinateDisplay } from \"@/components/coordinate-display\";\nimport { LeafletMap } from \"@/components/map/leaflet-map\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Anchor, MapPin, Navigation, Loader2, Clock, Wifi, WifiOff, Ship, User, Signal, SignalHigh, SignalLow, SignalMedium, LogOut, MapPinned, Crosshair, Power, PowerOff, X } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { FishermanProfile, OnlineSession } from \"@shared/schema\";\n\ninterface ProfileData {\n  profile: FishermanProfile | null;\n  activeSession: OnlineSession | null;\n}\n\ninterface PinnedLocation {\n  lat: number;\n  lng: number;\n}\n\nconst UPDATE_INTERVAL = 10000;\n\nexport default function FishermanApp() {\n  const { user } = useAuth();\n  const [isOnline, setIsOnline] = useState(false);\n  const [isPinMode, setIsPinMode] = useState(false);\n  const [pinnedLocation, setPinnedLocation] = useState<PinnedLocation | null>(null);\n  const [lastSentTime, setLastSentTime] = useState<Date | null>(null);\n  const [fishermanName, setFishermanName] = useState(\"\");\n  const [boatName, setBoatName] = useState(\"\");\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const {\n    latitude,\n    longitude,\n    accuracy,\n    accuracyLevel,\n    error: gpsError,\n    isTracking,\n    isAcquiring,\n    lastUpdate,\n    startTracking,\n    stopTracking,\n    clearLocation,\n  } = useGeolocation({\n    enableHighAccuracy: true,\n    timeout: 15000,\n    maximumAge: 0,\n  });\n\n  const { data: profileData, isLoading: isProfileLoading } = useQuery<ProfileData>({\n    queryKey: [\"/api/fisherman/profile\"],\n    enabled: !!user,\n  });\n\n  const profile = profileData?.profile;\n  const activeSession = profileData?.activeSession;\n\n  const hasGpsLocation = latitude !== null && longitude !== null;\n  const hasPinnedLocation = pinnedLocation !== null;\n  const hasAnyLocation = hasGpsLocation || hasPinnedLocation;\n  const canGoOnline = hasAnyLocation && !isOnline;\n\n  const currentLat = pinnedLocation?.lat ?? latitude;\n  const currentLng = pinnedLocation?.lng ?? longitude;\n  const locationSource = pinnedLocation ? \"pinned\" : (hasGpsLocation ? \"gps\" : null);\n\n  const createProfileMutation = useMutation({\n    mutationFn: async (data: { fishermanName: string; boatName: string }) => {\n      return apiRequest(\"POST\", \"/api/fisherman/profile\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/fisherman/profile\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Profile created\",\n        description: `Welcome ${fishermanName}! You can now share your location.`,\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Failed to create profile\",\n        description: error instanceof Error ? error.message : \"Please try again\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const startSharingMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", \"/api/fisherman/start-sharing\", {});\n    },\n    onSuccess: () => {\n      setIsOnline(true);\n      queryClient.invalidateQueries({ queryKey: [\"/api/fisherman/profile\"] });\n      toast({\n        title: \"You are now online\",\n        description: \"Your location is being shared with the Coast Guard.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Failed to go online\",\n        description: error instanceof Error ? error.message : \"Please try again\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const stopSharingMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", \"/api/fisherman/stop-sharing\", {});\n    },\n    onSuccess: () => {\n      setIsOnline(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/fisherman/profile\"] });\n      toast({\n        title: \"You are now offline\",\n        description: \"Your location is no longer being shared.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Failed to go offline\",\n        description: error instanceof Error ? error.message : \"Please try again\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const sendLocationMutation = useMutation({\n    mutationFn: async (location: { lat: number; lng: number; source: string; accuracy?: number }) => {\n      return apiRequest(\"POST\", \"/api/fisherman/location\", location);\n    },\n    onSuccess: () => {\n      setLastSentTime(new Date());\n    },\n    onError: (error) => {\n      console.error(\"Failed to send location:\", error);\n    },\n  });\n\n  const latRef = useRef(currentLat);\n  const lngRef = useRef(currentLng);\n  const sourceRef = useRef(locationSource);\n  const accuracyRef = useRef(accuracy);\n\n  useEffect(() => {\n    latRef.current = currentLat;\n    lngRef.current = currentLng;\n    sourceRef.current = locationSource;\n    accuracyRef.current = accuracy;\n  }, [currentLat, currentLng, locationSource, accuracy]);\n\n  useEffect(() => {\n    if (activeSession && !isOnline) {\n      setIsOnline(true);\n    }\n  }, [activeSession]);\n\n  useEffect(() => {\n    if (!isOnline || !profile) return;\n\n    const sendLocation = () => {\n      if (latRef.current !== null && lngRef.current !== null) {\n        sendLocationMutation.mutate({ \n          lat: latRef.current, \n          lng: lngRef.current,\n          source: sourceRef.current || \"gps\",\n          accuracy: accuracyRef.current ?? undefined,\n        });\n      }\n    };\n\n    sendLocation();\n    const interval = setInterval(sendLocation, UPDATE_INTERVAL);\n    return () => clearInterval(interval);\n  }, [isOnline, profile]);\n\n  const handleCreateProfile = useCallback(() => {\n    if (!fishermanName.trim() || !boatName.trim()) {\n      toast({\n        title: \"Missing information\",\n        description: \"Please enter both your name and boat name.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    createProfileMutation.mutate({ fishermanName: fishermanName.trim(), boatName: boatName.trim() });\n  }, [fishermanName, boatName, createProfileMutation, toast]);\n\n  const handleStartGpsTracking = useCallback(() => {\n    setPinnedLocation(null);\n    startTracking();\n  }, [startTracking]);\n\n  const handleStopGpsTracking = useCallback(() => {\n    stopTracking();\n    clearLocation();\n  }, [stopTracking, clearLocation]);\n\n  const handleTogglePinMode = useCallback(() => {\n    if (isPinMode) {\n      setIsPinMode(false);\n    } else {\n      stopTracking();\n      clearLocation();\n      setIsPinMode(true);\n      toast({\n        title: \"Pin mode enabled\",\n        description: \"Tap on the map to set your location manually.\",\n      });\n    }\n  }, [isPinMode, stopTracking, clearLocation, toast]);\n\n  const handleMapClick = useCallback((lat: number, lng: number) => {\n    if (isPinMode) {\n      setPinnedLocation({ lat, lng });\n      setIsPinMode(false);\n      toast({\n        title: \"Location pinned\",\n        description: \"Your manual location has been set.\",\n      });\n    }\n  }, [isPinMode, toast]);\n\n  const handleClearPinnedLocation = useCallback(() => {\n    setPinnedLocation(null);\n  }, []);\n\n  const handleGoOnline = useCallback(() => {\n    startSharingMutation.mutate();\n  }, [startSharingMutation]);\n\n  const handleGoOffline = useCallback(() => {\n    stopSharingMutation.mutate();\n  }, [stopSharingMutation]);\n\n  const formatTime = (date: Date | null) => {\n    if (!date) return \"--\";\n    return date.toLocaleTimeString(\"en-US\", {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      second: \"2-digit\",\n    });\n  };\n\n  const getAccuracyIcon = () => {\n    switch (accuracyLevel) {\n      case \"high\":\n        return <SignalHigh className=\"h-4 w-4 text-live\" />;\n      case \"medium\":\n        return <SignalMedium className=\"h-4 w-4 text-drift\" />;\n      case \"low\":\n        return <SignalLow className=\"h-4 w-4 text-danger\" />;\n      default:\n        return <Signal className=\"h-4 w-4 text-muted-foreground\" />;\n    }\n  };\n\n  const getAccuracyLabel = () => {\n    if (!accuracy) return \"--\";\n    if (accuracy <= 20) return `High (${accuracy.toFixed(0)}m)`;\n    if (accuracy <= 100) return `Medium (${accuracy.toFixed(0)}m)`;\n    return `Low (${accuracy.toFixed(0)}m)`;\n  };\n\n  const markers = [];\n  if (hasGpsLocation && !pinnedLocation) {\n    markers.push({ \n      lat: latitude!, \n      lng: longitude!, \n      type: \"live\" as const, \n      popup: \"Your GPS Location\",\n      accuracy: accuracy ?? undefined,\n    });\n  }\n  if (pinnedLocation) {\n    markers.push({ \n      lat: pinnedLocation.lat, \n      lng: pinnedLocation.lng, \n      type: \"pinned\" as const, \n      popup: \"Pinned Location (Manual)\" \n    });\n  }\n\n  if (isProfileLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-ocean mx-auto mb-4\" />\n          <p className=\"text-muted-foreground\">Loading profile...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!profile) {\n    return (\n      <div className=\"min-h-screen bg-background flex flex-col\">\n        <header className=\"sticky top-0 z-50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b\">\n          <div className=\"container mx-auto px-4 py-3 flex items-center justify-between gap-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-ocean rounded-lg\">\n                <Anchor className=\"h-6 w-6 text-white\" />\n              </div>\n              <div>\n                <h1 className=\"font-semibold text-lg\">CoastGuard Lite</h1>\n                <p className=\"text-xs text-muted-foreground\">Fisherman Tracker</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <ThemeToggle />\n              <Button \n                variant=\"outline\" \n                size=\"icon\"\n                onClick={() => window.location.href = \"/api/logout\"}\n                data-testid=\"button-logout\"\n              >\n                <LogOut className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        </header>\n\n        <main className=\"flex-1 container mx-auto px-4 py-6 flex items-center justify-center\">\n          <Card className=\"w-full max-w-md shadow-lg\">\n            <CardHeader className=\"text-center\">\n              <div className=\"mx-auto w-16 h-16 bg-ocean/10 rounded-full flex items-center justify-center mb-4\">\n                <Ship className=\"h-8 w-8 text-ocean\" />\n              </div>\n              <CardTitle className=\"text-xl\">Complete Your Profile</CardTitle>\n              <p className=\"text-sm text-muted-foreground mt-2\">\n                Enter your details to start sharing your location with the Coast Guard\n              </p>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"fishermanName\" className=\"flex items-center gap-2\">\n                  <User className=\"h-4 w-4\" />\n                  Your Name\n                </Label>\n                <Input\n                  id=\"fishermanName\"\n                  placeholder=\"Enter your name\"\n                  value={fishermanName}\n                  onChange={(e) => setFishermanName(e.target.value)}\n                  data-testid=\"input-fisherman-name\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"boatName\" className=\"flex items-center gap-2\">\n                  <Ship className=\"h-4 w-4\" />\n                  Boat Name\n                </Label>\n                <Input\n                  id=\"boatName\"\n                  placeholder=\"Enter your boat name\"\n                  value={boatName}\n                  onChange={(e) => setBoatName(e.target.value)}\n                  data-testid=\"input-boat-name\"\n                />\n              </div>\n              <Button\n                className=\"w-full h-12 bg-ocean hover:bg-ocean/90\"\n                onClick={handleCreateProfile}\n                disabled={createProfileMutation.isPending}\n                data-testid=\"button-create-profile\"\n              >\n                {createProfileMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"h-5 w-5 mr-2 animate-spin\" />\n                    Creating Profile...\n                  </>\n                ) : (\n                  <>\n                    <Navigation className=\"h-5 w-5 mr-2\" />\n                    Create Profile & Continue\n                  </>\n                )}\n              </Button>\n            </CardContent>\n          </Card>\n        </main>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <header className=\"sticky top-0 z-50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b\">\n        <div className=\"container mx-auto px-4 py-3 flex items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 bg-ocean rounded-lg\">\n              <Anchor className=\"h-6 w-6 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"font-semibold text-lg\">CoastGuard Lite</h1>\n              <p className=\"text-xs text-muted-foreground\">Fisherman Tracker</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <ThemeToggle />\n            <Button \n              variant=\"outline\" \n              size=\"icon\"\n              onClick={() => window.location.href = \"/api/logout\"}\n              data-testid=\"button-logout\"\n            >\n              <LogOut className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"flex-1 container mx-auto px-4 py-6 space-y-4 max-w-lg\">\n        <Card className=\"bg-ocean/5 border-ocean/20\">\n          <CardContent className=\"py-4 flex items-center justify-between gap-4 flex-wrap\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-ocean/10 rounded-full\">\n                <User className=\"h-5 w-5 text-ocean\" />\n              </div>\n              <div>\n                <p className=\"font-medium\" data-testid=\"text-fisherman-name\">{profile.fishermanName}</p>\n                <p className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                  <Ship className=\"h-3 w-3\" />\n                  <span data-testid=\"text-boat-name\">{profile.boatName}</span>\n                </p>\n              </div>\n            </div>\n            <ConnectionBadge isConnected={isOnline} />\n          </CardContent>\n        </Card>\n\n        {gpsError && (\n          <Card className=\"border-danger/30 bg-danger/5\">\n            <CardContent className=\"py-4 flex items-center gap-3 text-danger\">\n              <WifiOff className=\"h-5 w-5 flex-shrink-0\" />\n              <p className=\"text-sm font-medium\">{gpsError}</p>\n            </CardContent>\n          </Card>\n        )}\n\n        <Card className=\"shadow-lg overflow-hidden rounded-2xl\">\n          <div className=\"h-64 relative\">\n            <LeafletMap\n              center={\n                currentLat && currentLng\n                  ? [currentLat, currentLng]\n                  : [13.0827, 80.2707]\n              }\n              zoom={14}\n              markers={markers}\n              className=\"rounded-t-2xl\"\n              allowClick={isPinMode}\n              onMapClick={handleMapClick}\n            />\n            {isPinMode && (\n              <div className=\"absolute top-2 left-1/2 -translate-x-1/2 z-[1000]\">\n                <Badge className=\"bg-ocean text-white\">\n                  <Crosshair className=\"h-3 w-3 mr-1\" />\n                  Tap to pin location\n                </Badge>\n              </div>\n            )}\n          </div>\n          <CardContent className=\"p-4 space-y-4\">\n            <div className=\"flex items-center justify-between gap-2\">\n              <CoordinateDisplay\n                lat={currentLat}\n                lng={currentLng}\n                label={pinnedLocation ? \"Pinned Location\" : \"GPS Location\"}\n                showCopy={true}\n              />\n              {locationSource && (\n                <Badge variant={pinnedLocation ? \"secondary\" : \"outline\"} className=\"shrink-0\">\n                  {pinnedLocation ? (\n                    <>\n                      <MapPinned className=\"h-3 w-3 mr-1\" />\n                      Pinned\n                    </>\n                  ) : (\n                    <>\n                      <Navigation className=\"h-3 w-3 mr-1\" />\n                      GPS\n                    </>\n                  )}\n                </Badge>\n              )}\n            </div>\n            \n            {!pinnedLocation && hasGpsLocation && (\n              <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  {getAccuracyIcon()}\n                  <span data-testid=\"text-accuracy\">\n                    {getAccuracyLabel()}\n                  </span>\n                </div>\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  <Clock className=\"h-4 w-4\" />\n                  <span>Last: {formatTime(lastUpdate)}</span>\n                </div>\n              </div>\n            )}\n\n            {accuracyLevel === \"low\" && !pinnedLocation && (\n              <div className=\"bg-danger/10 border border-danger/20 rounded-lg p-3 text-sm text-danger\">\n                Low GPS accuracy detected. Try moving to an open area for better signal, or use the pin feature to set your location manually.\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <div className=\"grid grid-cols-2 gap-3\">\n          {!isTracking ? (\n            <Button\n              className=\"h-12 bg-live hover:bg-live/90\"\n              onClick={handleStartGpsTracking}\n              disabled={isOnline}\n              data-testid=\"button-start-gps\"\n            >\n              {isAcquiring ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Acquiring...\n                </>\n              ) : (\n                <>\n                  <Navigation className=\"h-4 w-4 mr-2\" />\n                  Use GPS\n                </>\n              )}\n            </Button>\n          ) : (\n            <Button\n              variant=\"outline\"\n              className=\"h-12 border-danger text-danger hover:bg-danger/10\"\n              onClick={handleStopGpsTracking}\n              disabled={isOnline}\n              data-testid=\"button-stop-gps\"\n            >\n              <WifiOff className=\"h-4 w-4 mr-2\" />\n              Stop GPS\n            </Button>\n          )}\n\n          {!pinnedLocation ? (\n            <Button\n              variant={isPinMode ? \"default\" : \"outline\"}\n              className={`h-12 ${isPinMode ? \"bg-ocean hover:bg-ocean/90\" : \"\"}`}\n              onClick={handleTogglePinMode}\n              disabled={isOnline}\n              data-testid=\"button-pin-location\"\n            >\n              {isPinMode ? (\n                <>\n                  <X className=\"h-4 w-4 mr-2\" />\n                  Cancel Pin\n                </>\n              ) : (\n                <>\n                  <MapPinned className=\"h-4 w-4 mr-2\" />\n                  Pin Location\n                </>\n              )}\n            </Button>\n          ) : (\n            <Button\n              variant=\"outline\"\n              className=\"h-12\"\n              onClick={handleClearPinnedLocation}\n              disabled={isOnline}\n              data-testid=\"button-clear-pin\"\n            >\n              <X className=\"h-4 w-4 mr-2\" />\n              Clear Pin\n            </Button>\n          )}\n        </div>\n\n        <Button\n          className={`w-full h-14 rounded-xl text-lg font-semibold shadow-lg transition-all ${\n            isOnline\n              ? \"bg-danger hover:bg-danger/90\"\n              : hasAnyLocation\n              ? \"bg-live hover:bg-live/90\"\n              : \"bg-muted text-muted-foreground\"\n          }`}\n          onClick={isOnline ? handleGoOffline : handleGoOnline}\n          disabled={(!canGoOnline && !isOnline) || startSharingMutation.isPending || stopSharingMutation.isPending}\n          data-testid=\"button-go-online\"\n        >\n          {startSharingMutation.isPending ? (\n            <>\n              <Loader2 className=\"h-5 w-5 mr-2 animate-spin\" />\n              Going online...\n            </>\n          ) : stopSharingMutation.isPending ? (\n            <>\n              <Loader2 className=\"h-5 w-5 mr-2 animate-spin\" />\n              Going offline...\n            </>\n          ) : isOnline ? (\n            <>\n              <PowerOff className=\"h-5 w-5 mr-2\" />\n              Go Offline\n            </>\n          ) : hasAnyLocation ? (\n            <>\n              <Power className=\"h-5 w-5 mr-2\" />\n              Go Online\n            </>\n          ) : (\n            <>\n              <Power className=\"h-5 w-5 mr-2\" />\n              Set location to go online\n            </>\n          )}\n        </Button>\n\n        {isOnline && (\n          <Card className=\"bg-live/5 border-live/20\">\n            <CardContent className=\"py-4 flex items-center justify-center gap-3\">\n              <Wifi className=\"h-5 w-5 text-live animate-pulse\" />\n              <div className=\"text-center\">\n                <p className=\"text-sm font-medium text-live\">\n                  Sending updates every 10 seconds\n                </p>\n                <p className=\"text-xs text-muted-foreground\">\n                  Last sent: {formatTime(lastSentTime)} | Source: {locationSource === \"pinned\" ? \"Manual Pin\" : \"GPS\"}\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {!hasAnyLocation && !isTracking && !isPinMode && (\n          <Card className=\"bg-muted/50\">\n            <CardContent className=\"py-4 text-center\">\n              <p className=\"text-sm text-muted-foreground\">\n                Use <strong>GPS</strong> for automatic location tracking, or <strong>Pin Location</strong> to set your position manually on the map.\n              </p>\n            </CardContent>\n          </Card>\n        )}\n\n        <div className=\"text-center text-sm text-muted-foreground space-y-1\">\n          <p>Keep your screen on for continuous tracking</p>\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":23053,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/pages/home.tsx":{"content":"import { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { \n  Anchor, \n  Navigation, \n  Radar, \n  MapPin, \n  Waves, \n  Shield, \n  ArrowRight,\n  Ship,\n  Radio\n} from \"lucide-react\";\n\nexport default function Home() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"sticky top-0 z-50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 bg-ocean rounded-lg\">\n              <Anchor className=\"h-6 w-6 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"font-bold text-xl\">CoastGuard Lite</h1>\n              <p className=\"text-xs text-muted-foreground\">GPS Tracking & Drift Prediction</p>\n            </div>\n          </div>\n          <ThemeToggle />\n        </div>\n      </header>\n\n      <main>\n        <section className=\"relative py-16 md:py-24 overflow-hidden\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-ocean/10 via-background to-ocean-dark/5\" />\n          <div className=\"container mx-auto px-4 relative z-10\">\n            <div className=\"max-w-3xl mx-auto text-center space-y-6\">\n              <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-ocean/10 text-ocean-dark dark:text-ocean text-sm font-medium\">\n                <Radio className=\"h-4 w-4\" />\n                <span>Real-time GPS Tracking System</span>\n              </div>\n              <h2 className=\"text-4xl md:text-5xl font-bold tracking-tight\">\n                Protecting Fishermen at Sea with{\" \"}\n                <span className=\"text-ocean\">Smart Tracking</span>\n              </h2>\n              <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n                Track fishermen in real-time using GPS, detect signal loss automatically, \n                and predict drift locations using advanced ocean current and wind data analysis.\n              </p>\n              <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4 pt-4\">\n                <Link href=\"/fisherman\">\n                  <Button size=\"lg\" className=\"h-12 px-8 bg-live hover:bg-live/90\" data-testid=\"link-fisherman-app\">\n                    <Navigation className=\"h-5 w-5 mr-2\" />\n                    Fisherman App\n                    <ArrowRight className=\"h-4 w-4 ml-2\" />\n                  </Button>\n                </Link>\n                <Link href=\"/dashboard\">\n                  <Button size=\"lg\" variant=\"outline\" className=\"h-12 px-8\" data-testid=\"link-dashboard\">\n                    <Radar className=\"h-5 w-5 mr-2\" />\n                    Coast Guard Dashboard\n                    <ArrowRight className=\"h-4 w-4 ml-2\" />\n                  </Button>\n                </Link>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        <section className=\"py-16 border-t\">\n          <div className=\"container mx-auto px-4\">\n            <div className=\"text-center space-y-2 mb-12\">\n              <h3 className=\"text-2xl font-bold\">How It Works</h3>\n              <p className=\"text-muted-foreground\">\n                A complete solution for maritime safety and search operations\n              </p>\n            </div>\n            <div className=\"grid md:grid-cols-3 gap-6 max-w-5xl mx-auto\">\n              <Card className=\"hover-elevate\">\n                <CardHeader>\n                  <div className=\"w-12 h-12 rounded-lg bg-live/10 flex items-center justify-center mb-4\">\n                    <MapPin className=\"h-6 w-6 text-live\" />\n                  </div>\n                  <CardTitle className=\"text-lg\">Live GPS Tracking</CardTitle>\n                  <CardDescription>\n                    Fishermen share their GPS coordinates in real-time every 10 seconds \n                    while connected to the network.\n                  </CardDescription>\n                </CardHeader>\n              </Card>\n              <Card className=\"hover-elevate\">\n                <CardHeader>\n                  <div className=\"w-12 h-12 rounded-lg bg-drift/10 flex items-center justify-center mb-4\">\n                    <Radar className=\"h-6 w-6 text-drift\" />\n                  </div>\n                  <CardTitle className=\"text-lg\">Signal Loss Detection</CardTitle>\n                  <CardDescription>\n                    Automatic detection when GPS signal is lost for more than 60 seconds, \n                    triggering drift prediction mode.\n                  </CardDescription>\n                </CardHeader>\n              </Card>\n              <Card className=\"hover-elevate\">\n                <CardHeader>\n                  <div className=\"w-12 h-12 rounded-lg bg-ocean/10 flex items-center justify-center mb-4\">\n                    <Waves className=\"h-6 w-6 text-ocean\" />\n                  </div>\n                  <CardTitle className=\"text-lg\">Drift Prediction</CardTitle>\n                  <CardDescription>\n                    Monte Carlo simulation using real marine weather data to predict \n                    probable drift locations and search areas.\n                  </CardDescription>\n                </CardHeader>\n              </Card>\n            </div>\n          </div>\n        </section>\n\n        <section className=\"py-16 bg-card/50 border-t\">\n          <div className=\"container mx-auto px-4\">\n            <div className=\"grid md:grid-cols-2 gap-12 items-center max-w-5xl mx-auto\">\n              <div className=\"space-y-6\">\n                <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-ocean/10 text-ocean-dark dark:text-ocean text-sm\">\n                  <Ship className=\"h-4 w-4\" />\n                  <span>For Fishermen</span>\n                </div>\n                <h3 className=\"text-3xl font-bold\">Simple Mobile App</h3>\n                <p className=\"text-muted-foreground\">\n                  A battery-efficient mobile web app that fishermen can use to share \n                  their location with the coast guard. Just tap one button to start \n                  or stop sharing your GPS coordinates.\n                </p>\n                <ul className=\"space-y-3\">\n                  <li className=\"flex items-center gap-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-live/20 flex items-center justify-center\">\n                      <Navigation className=\"h-3 w-3 text-live\" />\n                    </div>\n                    <span className=\"text-sm\">One-tap location sharing</span>\n                  </li>\n                  <li className=\"flex items-center gap-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-live/20 flex items-center justify-center\">\n                      <MapPin className=\"h-3 w-3 text-live\" />\n                    </div>\n                    <span className=\"text-sm\">Live map preview</span>\n                  </li>\n                  <li className=\"flex items-center gap-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-live/20 flex items-center justify-center\">\n                      <Radio className=\"h-3 w-3 text-live\" />\n                    </div>\n                    <span className=\"text-sm\">Connection status indicator</span>\n                  </li>\n                </ul>\n              </div>\n              <div className=\"space-y-6\">\n                <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 text-primary text-sm\">\n                  <Shield className=\"h-4 w-4\" />\n                  <span>For Coast Guard</span>\n                </div>\n                <h3 className=\"text-3xl font-bold\">Powerful Dashboard</h3>\n                <p className=\"text-muted-foreground\">\n                  A comprehensive dashboard with live tracking maps, drift prediction \n                  visualization, search area heatmaps, and real-time marine weather data \n                  integration.\n                </p>\n                <ul className=\"space-y-3\">\n                  <li className=\"flex items-center gap-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-primary/20 flex items-center justify-center\">\n                      <Radar className=\"h-3 w-3 text-primary\" />\n                    </div>\n                    <span className=\"text-sm\">Monte Carlo drift simulation</span>\n                  </li>\n                  <li className=\"flex items-center gap-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-primary/20 flex items-center justify-center\">\n                      <Waves className=\"h-3 w-3 text-primary\" />\n                    </div>\n                    <span className=\"text-sm\">Real-time marine weather data</span>\n                  </li>\n                  <li className=\"flex items-center gap-3\">\n                    <div className=\"w-6 h-6 rounded-full bg-primary/20 flex items-center justify-center\">\n                      <MapPin className=\"h-3 w-3 text-primary\" />\n                    </div>\n                    <span className=\"text-sm\">Search area heatmap visualization</span>\n                  </li>\n                </ul>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        <section className=\"py-16 border-t\">\n          <div className=\"container mx-auto px-4 text-center\">\n            <div className=\"max-w-2xl mx-auto space-y-6\">\n              <h3 className=\"text-2xl font-bold\">Ready to Get Started?</h3>\n              <p className=\"text-muted-foreground\">\n                Choose your app based on your role. Fishermen should use the mobile app, \n                while coast guard personnel should access the dashboard.\n              </p>\n              <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4 pt-4\">\n                <Link href=\"/fisherman\">\n                  <Button size=\"lg\" className=\"w-full sm:w-auto bg-live hover:bg-live/90\" data-testid=\"link-fisherman-app-footer\">\n                    <Navigation className=\"h-5 w-5 mr-2\" />\n                    Open Fisherman App\n                  </Button>\n                </Link>\n                <Link href=\"/dashboard\">\n                  <Button size=\"lg\" variant=\"outline\" className=\"w-full sm:w-auto\" data-testid=\"link-dashboard-footer\">\n                    <Radar className=\"h-5 w-5 mr-2\" />\n                    Open Dashboard\n                  </Button>\n                </Link>\n              </div>\n            </div>\n          </div>\n        </section>\n      </main>\n\n      <footer className=\"py-8 border-t\">\n        <div className=\"container mx-auto px-4 text-center text-sm text-muted-foreground\">\n          <p>CoastGuard Lite - GPS Tracking & Drift Prediction System</p>\n          <p className=\"mt-1\">Powered by Open-Meteo Marine Weather API</p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":11030,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"server/storage.ts":{"content":"import {\n  users,\n  fishermanProfiles,\n  fishermanLocations,\n  onlineSessions,\n  driftResults,\n  alerts,\n  marineWeather,\n  type User,\n  type UpsertUser,\n  type FishermanProfile,\n  type InsertFishermanProfile,\n  type FishermanLocation,\n  type InsertFishermanLocation,\n  type OnlineSession,\n  type InsertOnlineSession,\n  type DriftResult,\n  type InsertDriftResult,\n  type Alert,\n  type InsertAlert,\n  type MarineWeather,\n  type InsertMarineWeather,\n  type FishermanState,\n  type TrackingMode,\n  type FishermanWithState,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, or, ilike, isNull } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User operations for email/password auth\n  getUser(id: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: { email: string; passwordHash: string; firstName: string; lastName: string; role: string }): Promise<User>;\n  updateUserRole(userId: string, role: string): Promise<User | undefined>;\n  \n  // Fisherman profile operations\n  createFishermanProfile(profile: InsertFishermanProfile): Promise<FishermanProfile>;\n  getFishermanProfileByUserId(userId: string): Promise<FishermanProfile | undefined>;\n  getFishermanProfileById(id: string): Promise<FishermanProfile | undefined>;\n  getAllFishermanProfiles(): Promise<FishermanProfile[]>;\n  searchFishermanProfiles(query: string): Promise<FishermanProfile[]>;\n  \n  // Online session operations\n  startOnlineSession(fishermanProfileId: string): Promise<OnlineSession>;\n  endOnlineSession(sessionId: string, lastLat: number, lastLng: number): Promise<OnlineSession | undefined>;\n  getActiveSession(fishermanProfileId: string): Promise<OnlineSession | undefined>;\n  getOnlineSessionHistory(fishermanProfileId: string, limit?: number): Promise<OnlineSession[]>;\n  getLastOnlineSession(fishermanProfileId: string): Promise<OnlineSession | undefined>;\n  \n  // Location operations\n  saveFishermanLocation(location: InsertFishermanLocation): Promise<FishermanLocation>;\n  getLatestFishermanLocation(fishermanProfileId: string): Promise<FishermanLocation | undefined>;\n  getFishermanLocations(fishermanProfileId: string, limit?: number): Promise<FishermanLocation[]>;\n  getLocationsBySession(onlineSessionId: string): Promise<FishermanLocation[]>;\n  \n  // Drift results\n  saveDriftResult(result: InsertDriftResult): Promise<DriftResult>;\n  getLatestDriftResult(fishermanProfileId: string): Promise<DriftResult | undefined>;\n  getDriftResultBySession(onlineSessionId: string): Promise<DriftResult | undefined>;\n  \n  // Alerts\n  createAlert(alert: InsertAlert): Promise<Alert>;\n  getAlerts(fishermanProfileId?: string): Promise<Alert[]>;\n  dismissAlert(alertId: string): Promise<void>;\n  \n  // Marine weather\n  saveMarineWeather(weather: InsertMarineWeather): Promise<MarineWeather>;\n  getLatestMarineWeather(lat: number, lng: number): Promise<MarineWeather | undefined>;\n  \n  // Combined queries\n  getFishermanState(fishermanProfileId: string): Promise<FishermanState | undefined>;\n  getAllFishermenWithState(): Promise<FishermanWithState[]>;\n  searchFishermenWithState(query: string): Promise<FishermanWithState[]>;\n  updateFishermanStatus(fishermanProfileId: string, status: \"online\" | \"offline\"): Promise<void>;\n  setFishermanMode(fishermanProfileId: string, mode: TrackingMode): Promise<void>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  private fishermanStates: Map<string, FishermanState> = new Map();\n\n  // User operations for email/password auth\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async createUser(userData: { email: string; passwordHash: string; firstName: string; lastName: string; role: string }): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .returning();\n    return user;\n  }\n\n  async updateUserRole(userId: string, role: string): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ role, updatedAt: new Date() })\n      .where(eq(users.id, userId))\n      .returning();\n    return user;\n  }\n\n  // Fisherman profile operations\n  async createFishermanProfile(profile: InsertFishermanProfile): Promise<FishermanProfile> {\n    const [newProfile] = await db\n      .insert(fishermanProfiles)\n      .values(profile)\n      .returning();\n    \n    // Initialize fisherman state\n    this.fishermanStates.set(newProfile.id, {\n      id: newProfile.id,\n      visibleFishermanId: newProfile.id,\n      fishermanName: newProfile.fishermanName,\n      boatName: newProfile.boatName,\n      currentLocation: null,\n      lastKnownLocation: null,\n      lastUpdateTime: null,\n      status: \"offline\",\n      mode: \"live\",\n    });\n    \n    return newProfile;\n  }\n\n  async getFishermanProfileByUserId(userId: string): Promise<FishermanProfile | undefined> {\n    const [profile] = await db\n      .select()\n      .from(fishermanProfiles)\n      .where(eq(fishermanProfiles.userId, userId));\n    return profile;\n  }\n\n  async getFishermanProfileById(id: string): Promise<FishermanProfile | undefined> {\n    const [profile] = await db\n      .select()\n      .from(fishermanProfiles)\n      .where(eq(fishermanProfiles.id, id));\n    return profile;\n  }\n\n  async getAllFishermanProfiles(): Promise<FishermanProfile[]> {\n    return await db\n      .select()\n      .from(fishermanProfiles)\n      .orderBy(desc(fishermanProfiles.registeredAt));\n  }\n\n  async searchFishermanProfiles(query: string): Promise<FishermanProfile[]> {\n    const searchPattern = `%${query}%`;\n    return await db\n      .select()\n      .from(fishermanProfiles)\n      .where(\n        or(\n          ilike(fishermanProfiles.fishermanName, searchPattern),\n          ilike(fishermanProfiles.boatName, searchPattern)\n        )\n      );\n  }\n\n  // Online session operations\n  async startOnlineSession(fishermanProfileId: string): Promise<OnlineSession> {\n    // End any active session first\n    const activeSession = await this.getActiveSession(fishermanProfileId);\n    if (activeSession) {\n      const lastLocation = await this.getLatestFishermanLocation(fishermanProfileId);\n      if (lastLocation) {\n        await this.endOnlineSession(activeSession.id, lastLocation.lat, lastLocation.lng);\n      }\n    }\n\n    const [session] = await db\n      .insert(onlineSessions)\n      .values({\n        fishermanProfileId,\n        status: \"active\",\n      })\n      .returning();\n    return session;\n  }\n\n  async endOnlineSession(sessionId: string, lastLat: number, lastLng: number): Promise<OnlineSession | undefined> {\n    const [session] = await db\n      .update(onlineSessions)\n      .set({\n        endedAt: new Date(),\n        lastLocationLat: lastLat,\n        lastLocationLng: lastLng,\n        status: \"ended\",\n      })\n      .where(eq(onlineSessions.id, sessionId))\n      .returning();\n    return session;\n  }\n\n  async getActiveSession(fishermanProfileId: string): Promise<OnlineSession | undefined> {\n    const [session] = await db\n      .select()\n      .from(onlineSessions)\n      .where(\n        and(\n          eq(onlineSessions.fishermanProfileId, fishermanProfileId),\n          eq(onlineSessions.status, \"active\")\n        )\n      );\n    return session;\n  }\n\n  async getOnlineSessionHistory(fishermanProfileId: string, limit = 20): Promise<OnlineSession[]> {\n    return await db\n      .select()\n      .from(onlineSessions)\n      .where(eq(onlineSessions.fishermanProfileId, fishermanProfileId))\n      .orderBy(desc(onlineSessions.startedAt))\n      .limit(limit);\n  }\n\n  async getLastOnlineSession(fishermanProfileId: string): Promise<OnlineSession | undefined> {\n    const [session] = await db\n      .select()\n      .from(onlineSessions)\n      .where(\n        and(\n          eq(onlineSessions.fishermanProfileId, fishermanProfileId),\n          eq(onlineSessions.status, \"ended\")\n        )\n      )\n      .orderBy(desc(onlineSessions.endedAt))\n      .limit(1);\n    return session;\n  }\n\n  // Location operations\n  async saveFishermanLocation(location: InsertFishermanLocation): Promise<FishermanLocation> {\n    const [newLocation] = await db\n      .insert(fishermanLocations)\n      .values(location)\n      .returning();\n\n    // Update fisherman state\n    let state = this.fishermanStates.get(location.fishermanProfileId);\n    if (!state) {\n      const profile = await this.getFishermanProfileById(location.fishermanProfileId);\n      state = {\n        id: location.fishermanProfileId,\n        visibleFishermanId: location.fishermanProfileId,\n        fishermanName: profile?.fishermanName,\n        boatName: profile?.boatName,\n        currentLocation: null,\n        lastKnownLocation: null,\n        lastUpdateTime: null,\n        status: \"offline\",\n        mode: \"live\",\n      };\n    }\n\n    state.currentLocation = { lat: location.lat, lng: location.lng };\n    state.lastKnownLocation = { lat: location.lat, lng: location.lng };\n    state.lastUpdateTime = new Date();\n    state.status = (location.status as \"online\" | \"offline\") || \"online\";\n    if (state.status === \"online\") {\n      state.mode = \"live\";\n    }\n    this.fishermanStates.set(location.fishermanProfileId, state);\n\n    return newLocation;\n  }\n\n  async getLatestFishermanLocation(fishermanProfileId: string): Promise<FishermanLocation | undefined> {\n    const [location] = await db\n      .select()\n      .from(fishermanLocations)\n      .where(eq(fishermanLocations.fishermanProfileId, fishermanProfileId))\n      .orderBy(desc(fishermanLocations.timestamp))\n      .limit(1);\n    return location;\n  }\n\n  async getFishermanLocations(fishermanProfileId: string, limit = 100): Promise<FishermanLocation[]> {\n    return await db\n      .select()\n      .from(fishermanLocations)\n      .where(eq(fishermanLocations.fishermanProfileId, fishermanProfileId))\n      .orderBy(desc(fishermanLocations.timestamp))\n      .limit(limit);\n  }\n\n  async getLocationsBySession(onlineSessionId: string): Promise<FishermanLocation[]> {\n    return await db\n      .select()\n      .from(fishermanLocations)\n      .where(eq(fishermanLocations.onlineSessionId, onlineSessionId))\n      .orderBy(desc(fishermanLocations.timestamp));\n  }\n\n  // Drift results\n  async saveDriftResult(result: InsertDriftResult): Promise<DriftResult> {\n    const [driftResult] = await db\n      .insert(driftResults)\n      .values(result)\n      .returning();\n    return driftResult;\n  }\n\n  async getLatestDriftResult(fishermanProfileId: string): Promise<DriftResult | undefined> {\n    const [result] = await db\n      .select()\n      .from(driftResults)\n      .where(eq(driftResults.fishermanProfileId, fishermanProfileId))\n      .orderBy(desc(driftResults.generatedAt))\n      .limit(1);\n    return result;\n  }\n\n  async getDriftResultBySession(onlineSessionId: string): Promise<DriftResult | undefined> {\n    const [result] = await db\n      .select()\n      .from(driftResults)\n      .where(eq(driftResults.onlineSessionId, onlineSessionId))\n      .orderBy(desc(driftResults.generatedAt))\n      .limit(1);\n    return result;\n  }\n\n  // Alerts\n  async createAlert(alert: InsertAlert): Promise<Alert> {\n    const [newAlert] = await db\n      .insert(alerts)\n      .values(alert)\n      .returning();\n    return newAlert;\n  }\n\n  async getAlerts(fishermanProfileId?: string): Promise<Alert[]> {\n    if (fishermanProfileId) {\n      return await db\n        .select()\n        .from(alerts)\n        .where(\n          and(\n            eq(alerts.fishermanProfileId, fishermanProfileId),\n            eq(alerts.read, false)\n          )\n        )\n        .orderBy(desc(alerts.timestamp));\n    }\n    return await db\n      .select()\n      .from(alerts)\n      .where(eq(alerts.read, false))\n      .orderBy(desc(alerts.timestamp));\n  }\n\n  async dismissAlert(alertId: string): Promise<void> {\n    await db\n      .update(alerts)\n      .set({ read: true })\n      .where(eq(alerts.id, alertId));\n  }\n\n  // Marine weather\n  async saveMarineWeather(weather: InsertMarineWeather): Promise<MarineWeather> {\n    const [newWeather] = await db\n      .insert(marineWeather)\n      .values(weather)\n      .returning();\n    return newWeather;\n  }\n\n  async getLatestMarineWeather(lat: number, lng: number): Promise<MarineWeather | undefined> {\n    const results = await db\n      .select()\n      .from(marineWeather)\n      .orderBy(desc(marineWeather.fetchedAt))\n      .limit(10);\n    \n    // Find weather for nearby coordinates (within ~0.05 degrees)\n    const nearby = results.find(w => \n      Math.abs(w.lat - lat) < 0.05 && \n      Math.abs(w.lng - lng) < 0.05\n    );\n    \n    if (nearby) {\n      const ageMs = Date.now() - new Date(nearby.fetchedAt).getTime();\n      if (ageMs < 30 * 60 * 1000) { // 30 minutes\n        return nearby;\n      }\n    }\n    return undefined;\n  }\n\n  // Combined queries\n  async getFishermanState(fishermanProfileId: string): Promise<FishermanState | undefined> {\n    let state = this.fishermanStates.get(fishermanProfileId);\n    \n    if (!state) {\n      const profile = await this.getFishermanProfileById(fishermanProfileId);\n      if (!profile) return undefined;\n      \n      const lastLocation = await this.getLatestFishermanLocation(fishermanProfileId);\n      const activeSession = await this.getActiveSession(fishermanProfileId);\n      \n      state = {\n        id: fishermanProfileId,\n        visibleFishermanId: fishermanProfileId,\n        fishermanName: profile.fishermanName,\n        boatName: profile.boatName,\n        currentLocation: lastLocation && activeSession ? { lat: lastLocation.lat, lng: lastLocation.lng } : null,\n        lastKnownLocation: lastLocation ? { lat: lastLocation.lat, lng: lastLocation.lng } : null,\n        lastUpdateTime: lastLocation?.timestamp || null,\n        status: activeSession ? \"online\" : \"offline\",\n        mode: activeSession ? \"live\" : \"drift\",\n      };\n      this.fishermanStates.set(fishermanProfileId, state);\n    }\n    \n    return state;\n  }\n\n  async getAllFishermenWithState(): Promise<FishermanWithState[]> {\n    const profiles = await this.getAllFishermanProfiles();\n    return this.enrichProfilesWithState(profiles);\n  }\n\n  async searchFishermenWithState(query: string): Promise<FishermanWithState[]> {\n    const profiles = await this.searchFishermanProfiles(query);\n    return this.enrichProfilesWithState(profiles);\n  }\n\n  private async enrichProfilesWithState(profiles: FishermanProfile[]): Promise<FishermanWithState[]> {\n    const result: FishermanWithState[] = [];\n    \n    for (const profile of profiles) {\n      const state = await this.getFishermanState(profile.id);\n      const lastLocation = await this.getLatestFishermanLocation(profile.id);\n      const lastOnlineSession = await this.getLastOnlineSession(profile.id);\n      const user = await this.getUser(profile.userId);\n      \n      result.push({\n        fisherman: profile,\n        user: user || undefined,\n        state: state || null,\n        lastLocation: lastLocation\n          ? { lat: lastLocation.lat, lng: lastLocation.lng, timestamp: lastLocation.timestamp }\n          : null,\n        lastOnlineSession,\n      });\n    }\n    \n    return result;\n  }\n\n  async updateFishermanStatus(fishermanProfileId: string, status: \"online\" | \"offline\"): Promise<void> {\n    const state = this.fishermanStates.get(fishermanProfileId);\n    if (state) {\n      state.status = status;\n      if (status === \"offline\") {\n        state.mode = \"drift\";\n        state.currentLocation = null;\n        \n        // End active session\n        const activeSession = await this.getActiveSession(fishermanProfileId);\n        if (activeSession && state.lastKnownLocation) {\n          await this.endOnlineSession(\n            activeSession.id,\n            state.lastKnownLocation.lat,\n            state.lastKnownLocation.lng\n          );\n        }\n      }\n      this.fishermanStates.set(fishermanProfileId, state);\n    }\n  }\n\n  async setFishermanMode(fishermanProfileId: string, mode: TrackingMode): Promise<void> {\n    const state = this.fishermanStates.get(fishermanProfileId);\n    if (state) {\n      state.mode = mode;\n      this.fishermanStates.set(fishermanProfileId, state);\n    }\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":16323,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\n\nconst app = express();\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(server, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  server.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2480,"size_tokens":null},"replit.md":{"content":"# CoastGuard Lite - GPS Tracking & Drift Prediction System\n\n## Overview\n\nCoastGuard Lite is a real-time GPS tracking and drift prediction system designed to help coast guard teams locate fishermen at sea. The system tracks fishermen via GPS when network connectivity exists and automatically predicts drift locations when GPS signal is lost using marine weather data (wind, currents, waves).\n\n## Architecture\n\n### Frontend (React + TypeScript)\n- **Home Page** (`/`) - Landing page with overview of features and links to both apps\n- **Fisherman App** (`/fisherman`) - Mobile-first web app for fishermen to share GPS location\n- **Coast Guard Dashboard** (`/dashboard`) - Full tracking dashboard with map, drift simulation, and alerts\n\n### Backend (Express + TypeScript)\n- In-memory storage for development (easily swappable for PostgreSQL)\n- REST API for GPS tracking, drift simulation, and marine weather\n- Integration with Open-Meteo Marine API for real weather data\n\n### Key Technologies\n- React with wouter for routing\n- TanStack Query for data fetching\n- Leaflet.js for interactive maps\n- Tailwind CSS + shadcn/ui for styling\n- Open-Meteo Marine API for weather data\n\n## Project Structure\n\n```\nâ”œâ”€â”€ client/src/\nâ”‚   â”œâ”€â”€ components/          # Reusable UI components\nâ”‚   â”‚   â”œâ”€â”€ map/             # Leaflet map components\nâ”‚   â”‚   â”œâ”€â”€ ui/              # shadcn UI components\nâ”‚   â”‚   â”œâ”€â”€ alert-banner.tsx\nâ”‚   â”‚   â”œâ”€â”€ coordinate-display.tsx\nâ”‚   â”‚   â”œâ”€â”€ marine-weather-card.tsx\nâ”‚   â”‚   â”œâ”€â”€ simulation-controls.tsx\nâ”‚   â”‚   â”œâ”€â”€ status-badge.tsx\nâ”‚   â”‚   â””â”€â”€ theme-toggle.tsx\nâ”‚   â”œâ”€â”€ hooks/               # Custom React hooks\nâ”‚   â”‚   â”œâ”€â”€ use-geolocation.ts\nâ”‚   â”‚   â”œâ”€â”€ use-theme.ts\nâ”‚   â”‚   â””â”€â”€ use-toast.ts\nâ”‚   â”œâ”€â”€ pages/               # Page components\nâ”‚   â”‚   â”œâ”€â”€ dashboard.tsx    # Coast Guard dashboard\nâ”‚   â”‚   â”œâ”€â”€ fisherman-app.tsx # Fisherman mobile app\nâ”‚   â”‚   â”œâ”€â”€ home.tsx         # Landing page\nâ”‚   â”‚   â””â”€â”€ not-found.tsx\nâ”‚   â””â”€â”€ App.tsx              # Main app with routing\nâ”œâ”€â”€ server/\nâ”‚   â”œâ”€â”€ drift-engine.ts      # Monte Carlo drift simulation\nâ”‚   â”œâ”€â”€ marine-api.ts        # Open-Meteo API integration\nâ”‚   â”œâ”€â”€ routes.ts            # API endpoints\nâ”‚   â””â”€â”€ storage.ts           # Data storage interface\nâ””â”€â”€ shared/\n    â””â”€â”€ schema.ts            # Shared TypeScript types\n```\n\n## API Endpoints\n\n| Method | Endpoint | Description |\n|--------|----------|-------------|\n| POST | `/api/fisherman/location` | Save fisherman GPS location |\n| GET | `/api/fisherman/:id` | Get fisherman state and last location |\n| GET | `/api/dashboard/fisherman` | Get fisherman data for dashboard |\n| POST | `/api/fisherman/trigger-drift` | Manually trigger drift mode |\n| GET | `/api/marine-weather?lat=&lng=` | Fetch marine weather data |\n| POST | `/api/simulation/run` | Run Monte Carlo drift simulation |\n| GET | `/api/drift-result/:fishermanId` | Get latest drift result |\n| GET | `/api/alerts` | Get all alerts |\n| PATCH | `/api/alerts/:alertId/dismiss` | Dismiss an alert |\n\n## Features\n\n### GPS Tracking\n- Uses browser's `navigator.geolocation.watchPosition` API\n- Sends updates every 10 seconds when sharing is active\n- Automatic signal loss detection after 60 seconds of no updates\n\n### Drift Prediction Engine\n- Monte Carlo simulation generating 50-200 randomized drift paths\n- Uses real marine weather data (wind speed/direction, ocean currents)\n- Wind speed variation: Â±20%, Current speed variation: Â±15%\n- Direction variation: Â±10-20 degrees\n- Generates heatmap of probable search areas\n\n### Marine Weather Integration\n- Open-Meteo Marine API for wave height\n- Open-Meteo Weather API for wind speed/direction\n- Simulated ocean current data based on wind patterns\n- 30-minute caching for API responses\n\n## Running the Project\n\nThe application runs on port 5000:\n```bash\nnpm run dev\n```\n\nThis starts both the Express backend and Vite development server.\n\n## User Preferences\n\n- Dark mode toggle available on all pages\n- Auto-refresh toggle on dashboard (5-second intervals)\n- Simulation hours adjustable (1-12 hours)\n- Heatmap and drift path visibility toggles\n\n## Recent Changes\n\n- Initial implementation with full GPS tracking\n- Monte Carlo drift simulation engine\n- Open-Meteo Marine API integration\n- Leaflet map with heatmap visualization\n- Alert system for signal loss and simulation completion\n","path":null,"size_bytes":4530,"size_tokens":null},"server/marine-api.ts":{"content":"import axios from \"axios\";\nimport type { MarineWeatherData, InsertMarineWeather } from \"@shared/schema\";\nimport { storage } from \"./storage\";\n\nconst MARINE_API_BASE = \"https://marine-api.open-meteo.com/v1/marine\";\n\ninterface OpenMeteoMarineResponse {\n  latitude: number;\n  longitude: number;\n  hourly?: {\n    time: string[];\n    wind_wave_height?: number[];\n    wave_height?: number[];\n    wind_speed_10m?: number[];\n    wind_direction_10m?: number[];\n  };\n  current?: {\n    wind_speed_10m?: number;\n    wind_direction_10m?: number;\n    wave_height?: number;\n  };\n}\n\ninterface OpenMeteoWeatherResponse {\n  latitude: number;\n  longitude: number;\n  current?: {\n    wind_speed_10m?: number;\n    wind_direction_10m?: number;\n  };\n}\n\nexport async function fetchMarineWeather(\n  lat: number,\n  lng: number\n): Promise<MarineWeatherData> {\n  const cached = await storage.getLatestMarineWeather(lat, lng);\n  if (cached) {\n    return {\n      windSpeed: cached.windSpeed,\n      windDirection: cached.windDirection,\n      waveHeight: cached.waveHeight,\n      currentSpeed: cached.currentSpeed,\n      currentDirection: cached.currentDirection,\n    };\n  }\n\n  try {\n    const marineUrl = `${MARINE_API_BASE}?latitude=${lat}&longitude=${lng}&hourly=wave_height,wind_wave_height&timezone=auto`;\n    const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current=wind_speed_10m,wind_direction_10m&timezone=auto`;\n\n    const [marineResponse, weatherResponse] = await Promise.all([\n      axios.get<OpenMeteoMarineResponse>(marineUrl),\n      axios.get<OpenMeteoWeatherResponse>(weatherUrl),\n    ]);\n\n    const marineData = marineResponse.data;\n    const weatherData = weatherResponse.data;\n\n    const windSpeed = weatherData.current?.wind_speed_10m ?? 15;\n    const windDirection = weatherData.current?.wind_direction_10m ?? 180;\n    \n    const waveHeight = marineData.hourly?.wave_height?.[0] \n      ?? marineData.hourly?.wind_wave_height?.[0] \n      ?? 1.5;\n\n    const currentSpeed = 0.3 + Math.random() * 0.4;\n    const currentDirection = (windDirection + 30 + Math.random() * 60) % 360;\n\n    const weatherResult: MarineWeatherData = {\n      windSpeed,\n      windDirection,\n      waveHeight,\n      currentSpeed,\n      currentDirection,\n    };\n\n    const insertWeather: InsertMarineWeather = {\n      lat,\n      lng,\n      ...weatherResult,\n    };\n    await storage.saveMarineWeather(insertWeather);\n\n    return weatherResult;\n  } catch (error) {\n    console.error(\"Error fetching marine weather:\", error);\n    \n    const fallbackWeather: MarineWeatherData = {\n      windSpeed: 12 + Math.random() * 8,\n      windDirection: Math.random() * 360,\n      waveHeight: 1 + Math.random() * 2,\n      currentSpeed: 0.2 + Math.random() * 0.5,\n      currentDirection: Math.random() * 360,\n    };\n\n    return fallbackWeather;\n  }\n}\n\nexport function getWindDescription(speed: number): string {\n  if (speed < 5) return \"Calm\";\n  if (speed < 15) return \"Light breeze\";\n  if (speed < 25) return \"Moderate breeze\";\n  if (speed < 40) return \"Fresh breeze\";\n  if (speed < 55) return \"Strong breeze\";\n  return \"Gale\";\n}\n\nexport function getSeaStateDescription(waveHeight: number): string {\n  if (waveHeight < 0.5) return \"Calm\";\n  if (waveHeight < 1.25) return \"Smooth\";\n  if (waveHeight < 2.5) return \"Slight\";\n  if (waveHeight < 4) return \"Moderate\";\n  if (waveHeight < 6) return \"Rough\";\n  return \"Very rough\";\n}\n","path":null,"size_bytes":3412,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/pages/role-select.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Anchor, Ship, Shield, Loader2 } from \"lucide-react\";\n\nexport default function RoleSelect() {\n  const [selectedRole, setSelectedRole] = useState<string | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const setRoleMutation = useMutation({\n    mutationFn: async (role: string) => {\n      return apiRequest(\"POST\", \"/api/auth/set-role\", { role });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Role selected\",\n        description: \"Your account has been set up successfully.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Failed to set role\",\n        description: error instanceof Error ? error.message : \"Please try again\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSelectRole = (role: string) => {\n    setSelectedRole(role);\n    setRoleMutation.mutate(role);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <header className=\"sticky top-0 z-50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b\">\n        <div className=\"container mx-auto px-4 py-3 flex items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 bg-ocean rounded-lg\">\n              <Anchor className=\"h-6 w-6 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"font-semibold text-lg\">CoastGuard Lite</h1>\n              <p className=\"text-xs text-muted-foreground\">Choose Your Role</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <ThemeToggle />\n            <Button \n              variant=\"outline\"\n              onClick={() => window.location.href = \"/api/logout\"}\n              data-testid=\"button-logout\"\n            >\n              Sign Out\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"flex-1 container mx-auto px-4 py-12 flex items-center justify-center\">\n        <div className=\"max-w-2xl w-full\">\n          <div className=\"text-center mb-8\">\n            <h2 className=\"text-2xl font-bold mb-2\">Welcome!</h2>\n            <p className=\"text-muted-foreground\">\n              Please select your role to continue\n            </p>\n          </div>\n\n          <div className=\"grid md:grid-cols-2 gap-6\">\n            <Card \n              className={`cursor-pointer transition-all hover-elevate ${\n                selectedRole === \"fisherman\" ? \"ring-2 ring-ocean\" : \"\"\n              }`}\n              onClick={() => !setRoleMutation.isPending && handleSelectRole(\"fisherman\")}\n              data-testid=\"card-role-fisherman\"\n            >\n              <CardHeader className=\"text-center\">\n                <div className=\"w-16 h-16 bg-ocean/10 rounded-xl flex items-center justify-center mx-auto mb-4\">\n                  <Ship className=\"h-8 w-8 text-ocean\" />\n                </div>\n                <CardTitle>Fisherman</CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-center\">\n                <p className=\"text-sm text-muted-foreground mb-4\">\n                  Share your location with the Coast Guard while at sea\n                </p>\n                <Button \n                  className=\"w-full bg-ocean hover:bg-ocean/90\"\n                  disabled={setRoleMutation.isPending}\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleSelectRole(\"fisherman\");\n                  }}\n                  data-testid=\"button-select-fisherman\"\n                >\n                  {setRoleMutation.isPending && selectedRole === \"fisherman\" ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Setting up...\n                    </>\n                  ) : (\n                    \"Continue as Fisherman\"\n                  )}\n                </Button>\n              </CardContent>\n            </Card>\n\n            <Card \n              className={`cursor-pointer transition-all hover-elevate ${\n                selectedRole === \"coastguard\" ? \"ring-2 ring-primary\" : \"\"\n              }`}\n              onClick={() => !setRoleMutation.isPending && handleSelectRole(\"coastguard\")}\n              data-testid=\"card-role-coastguard\"\n            >\n              <CardHeader className=\"text-center\">\n                <div className=\"w-16 h-16 bg-primary/10 rounded-xl flex items-center justify-center mx-auto mb-4\">\n                  <Shield className=\"h-8 w-8 text-primary\" />\n                </div>\n                <CardTitle>Coast Guard</CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-center\">\n                <p className=\"text-sm text-muted-foreground mb-4\">\n                  Monitor fishermen and run drift predictions\n                </p>\n                <Button \n                  className=\"w-full\"\n                  disabled={setRoleMutation.isPending}\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleSelectRole(\"coastguard\");\n                  }}\n                  data-testid=\"button-select-coastguard\"\n                >\n                  {setRoleMutation.isPending && selectedRole === \"coastguard\" ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Setting up...\n                    </>\n                  ) : (\n                    \"Continue as Coast Guard\"\n                  )}\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":6127,"size_tokens":null},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n","path":null,"size_bytes":116,"size_tokens":null},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { getQueryFn } from \"@/lib/queryClient\";\nimport type { User, FishermanProfile } from \"@shared/schema\";\n\ninterface AuthUser extends User {\n  fishermanProfile: FishermanProfile | null;\n}\n\nexport function useAuth() {\n  const { data: user, isLoading, error } = useQuery<AuthUser | null>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: getQueryFn<AuthUser | null>({ on401: \"returnNull\" }),\n    retry: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n    isFisherman: user?.role === \"fisherman\",\n    isCoastGuard: user?.role === \"coastguard\",\n    hasFishermanProfile: !!user?.fishermanProfile,\n    error,\n  };\n}\n","path":null,"size_bytes":694,"size_tokens":null},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(claims: any) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  const registeredStrategies = new Set<string>();\n\n  const ensureStrategy = (domain: string) => {\n    const strategyName = `replitauth:${domain}`;\n    if (!registeredStrategies.has(strategyName)) {\n      const strategy = new Strategy(\n        {\n          name: strategyName,\n          config,\n          scope: \"openid email profile offline_access\",\n          callbackURL: `https://${domain}/api/callback`,\n        },\n        verify,\n      );\n      passport.use(strategy);\n      registeredStrategies.add(strategyName);\n    }\n  };\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n\nexport const requireRole = (role: string): RequestHandler => {\n  return async (req, res, next) => {\n    const user = req.user as any;\n    if (!user?.claims?.sub) {\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n\n    const dbUser = await storage.getUser(user.claims.sub);\n    if (!dbUser || dbUser.role !== role) {\n      return res.status(403).json({ message: \"Forbidden: Insufficient permissions\" });\n    }\n\n    next();\n  };\n};\n","path":null,"size_bytes":4818,"size_tokens":null},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","path":null,"size_bytes":483,"size_tokens":null},"client/src/pages/landing.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { registerSchema, loginSchema } from \"@shared/schema\";\nimport { Anchor, Ship, Shield, MapPin, Radio, Navigation, Loader2, Eye, EyeOff } from \"lucide-react\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { z } from \"zod\";\n\ntype RegisterFormData = z.infer<typeof registerSchema>;\ntype LoginFormData = z.infer<typeof loginSchema>;\n\nexport default function Landing() {\n  const [activeTab, setActiveTab] = useState<string>(\"login\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [showRegisterPassword, setShowRegisterPassword] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const registerForm = useForm<RegisterFormData>({\n    resolver: zodResolver(registerSchema),\n    defaultValues: {\n      email: \"\",\n      password: \"\",\n      firstName: \"\",\n      lastName: \"\",\n      role: undefined,\n    },\n  });\n\n  const loginForm = useForm<LoginFormData>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: {\n      email: \"\",\n      password: \"\",\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: RegisterFormData) => {\n      return apiRequest(\"POST\", \"/api/auth/register\", data);\n    },\n    onSuccess: async () => {\n      await queryClient.refetchQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Registration successful\",\n        description: \"Welcome to CoastGuard Lite!\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Registration failed\",\n        description: error.message || \"Please try again\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: LoginFormData) => {\n      return apiRequest(\"POST\", \"/api/auth/login\", data);\n    },\n    onSuccess: async () => {\n      await queryClient.refetchQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Login successful\",\n        description: \"Welcome back!\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Login failed\",\n        description: error.message || \"Invalid email or password\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onRegister = (data: RegisterFormData) => {\n    registerMutation.mutate(data);\n  };\n\n  const onLogin = (data: LoginFormData) => {\n    loginMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <header className=\"sticky top-0 z-50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b\">\n        <div className=\"container mx-auto px-4 py-3 flex items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 bg-ocean rounded-lg\">\n              <Anchor className=\"h-6 w-6 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"font-semibold text-lg\">CoastGuard Lite</h1>\n              <p className=\"text-xs text-muted-foreground\">Maritime Safety System</p>\n            </div>\n          </div>\n          <ThemeToggle />\n        </div>\n      </header>\n\n      <main className=\"flex-1 container mx-auto px-4 py-8\">\n        <div className=\"grid lg:grid-cols-2 gap-8 items-start max-w-6xl mx-auto\">\n          <div className=\"space-y-8\">\n            <div>\n              <h2 className=\"text-3xl font-bold mb-4\">\n                Real-Time GPS Tracking & Drift Prediction\n              </h2>\n              <p className=\"text-lg text-muted-foreground\">\n                Keep fishermen safe with live location sharing, automatic signal loss detection,\n                and Monte Carlo drift simulation for search and rescue operations.\n              </p>\n            </div>\n\n            <div className=\"grid sm:grid-cols-2 gap-4\">\n              <Card className=\"hover-elevate\">\n                <CardHeader className=\"pb-2\">\n                  <div className=\"w-12 h-12 bg-ocean/10 rounded-lg flex items-center justify-center mb-2\">\n                    <Ship className=\"h-6 w-6 text-ocean\" />\n                  </div>\n                  <CardTitle className=\"text-lg\">For Fishermen</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                    <li className=\"flex items-center gap-2\">\n                      <MapPin className=\"h-4 w-4 text-live flex-shrink-0\" />\n                      Real-time GPS tracking\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <Radio className=\"h-4 w-4 text-live flex-shrink-0\" />\n                      Automatic status updates\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <Navigation className=\"h-4 w-4 text-live flex-shrink-0\" />\n                      Easy location sharing\n                    </li>\n                  </ul>\n                </CardContent>\n              </Card>\n\n              <Card className=\"hover-elevate\">\n                <CardHeader className=\"pb-2\">\n                  <div className=\"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-2\">\n                    <Shield className=\"h-6 w-6 text-primary\" />\n                  </div>\n                  <CardTitle className=\"text-lg\">For Coast Guard</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                    <li className=\"flex items-center gap-2\">\n                      <MapPin className=\"h-4 w-4 text-ocean flex-shrink-0\" />\n                      Live tracking dashboard\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <Radio className=\"h-4 w-4 text-drift flex-shrink-0\" />\n                      Signal loss alerts\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <Navigation className=\"h-4 w-4 text-danger flex-shrink-0\" />\n                      Drift prediction & heatmaps\n                    </li>\n                  </ul>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n\n          <Card className=\"w-full max-w-md mx-auto lg:mx-0\">\n            <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n              <CardHeader className=\"pb-4\">\n                <TabsList className=\"grid w-full grid-cols-2\">\n                  <TabsTrigger value=\"login\" data-testid=\"tab-login\">Sign In</TabsTrigger>\n                  <TabsTrigger value=\"register\" data-testid=\"tab-register\">Register</TabsTrigger>\n                </TabsList>\n              </CardHeader>\n\n              <CardContent>\n                <TabsContent value=\"login\" className=\"mt-0\">\n                  <Form {...loginForm}>\n                    <form onSubmit={loginForm.handleSubmit(onLogin)} className=\"space-y-4\">\n                      <FormField\n                        control={loginForm.control}\n                        name=\"email\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Email</FormLabel>\n                            <FormControl>\n                              <Input\n                                type=\"email\"\n                                placeholder=\"you@example.com\"\n                                data-testid=\"input-login-email\"\n                                {...field}\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={loginForm.control}\n                        name=\"password\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Password</FormLabel>\n                            <FormControl>\n                              <div className=\"relative\">\n                                <Input\n                                  type={showPassword ? \"text\" : \"password\"}\n                                  placeholder=\"Enter your password\"\n                                  data-testid=\"input-login-password\"\n                                  {...field}\n                                />\n                                <Button\n                                  type=\"button\"\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  className=\"absolute right-0 top-0 h-full px-3 hover:bg-transparent\"\n                                  onClick={() => setShowPassword(!showPassword)}\n                                  data-testid=\"button-toggle-password\"\n                                >\n                                  {showPassword ? (\n                                    <EyeOff className=\"h-4 w-4 text-muted-foreground\" />\n                                  ) : (\n                                    <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                                  )}\n                                </Button>\n                              </div>\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <Button\n                        type=\"submit\"\n                        className=\"w-full\"\n                        disabled={loginMutation.isPending}\n                        data-testid=\"button-login-submit\"\n                      >\n                        {loginMutation.isPending ? (\n                          <>\n                            <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                            Signing in...\n                          </>\n                        ) : (\n                          \"Sign In\"\n                        )}\n                      </Button>\n                    </form>\n                  </Form>\n\n                  <p className=\"text-sm text-muted-foreground text-center mt-4\">\n                    Don't have an account?{\" \"}\n                    <button\n                      type=\"button\"\n                      className=\"text-primary hover:underline font-medium\"\n                      onClick={() => setActiveTab(\"register\")}\n                      data-testid=\"link-go-to-register\"\n                    >\n                      Register here\n                    </button>\n                  </p>\n                </TabsContent>\n\n                <TabsContent value=\"register\" className=\"mt-0\">\n                  <Form {...registerForm}>\n                    <form onSubmit={registerForm.handleSubmit(onRegister)} className=\"space-y-4\">\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <FormField\n                          control={registerForm.control}\n                          name=\"firstName\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>First Name</FormLabel>\n                              <FormControl>\n                                <Input\n                                  placeholder=\"John\"\n                                  data-testid=\"input-register-firstname\"\n                                  {...field}\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n\n                        <FormField\n                          control={registerForm.control}\n                          name=\"lastName\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Last Name</FormLabel>\n                              <FormControl>\n                                <Input\n                                  placeholder=\"Doe\"\n                                  data-testid=\"input-register-lastname\"\n                                  {...field}\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      </div>\n\n                      <FormField\n                        control={registerForm.control}\n                        name=\"email\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Email</FormLabel>\n                            <FormControl>\n                              <Input\n                                type=\"email\"\n                                placeholder=\"you@example.com\"\n                                data-testid=\"input-register-email\"\n                                {...field}\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={registerForm.control}\n                        name=\"password\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Password</FormLabel>\n                            <FormControl>\n                              <div className=\"relative\">\n                                <Input\n                                  type={showRegisterPassword ? \"text\" : \"password\"}\n                                  placeholder=\"At least 6 characters\"\n                                  data-testid=\"input-register-password\"\n                                  {...field}\n                                />\n                                <Button\n                                  type=\"button\"\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  className=\"absolute right-0 top-0 h-full px-3 hover:bg-transparent\"\n                                  onClick={() => setShowRegisterPassword(!showRegisterPassword)}\n                                  data-testid=\"button-toggle-register-password\"\n                                >\n                                  {showRegisterPassword ? (\n                                    <EyeOff className=\"h-4 w-4 text-muted-foreground\" />\n                                  ) : (\n                                    <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                                  )}\n                                </Button>\n                              </div>\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={registerForm.control}\n                        name=\"role\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>I am a...</FormLabel>\n                            <FormControl>\n                              <RadioGroup\n                                onValueChange={field.onChange}\n                                value={field.value}\n                                className=\"grid grid-cols-2 gap-4\"\n                              >\n                                <div>\n                                  <RadioGroupItem\n                                    value=\"fisherman\"\n                                    id=\"fisherman\"\n                                    className=\"peer sr-only\"\n                                  />\n                                  <Label\n                                    htmlFor=\"fisherman\"\n                                    className=\"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-4 hover-elevate cursor-pointer peer-data-[state=checked]:border-ocean [&:has([data-state=checked])]:border-ocean\"\n                                    data-testid=\"radio-role-fisherman\"\n                                  >\n                                    <Ship className=\"mb-2 h-6 w-6 text-ocean\" />\n                                    <span className=\"text-sm font-medium\">Fisherman</span>\n                                  </Label>\n                                </div>\n                                <div>\n                                  <RadioGroupItem\n                                    value=\"coastguard\"\n                                    id=\"coastguard\"\n                                    className=\"peer sr-only\"\n                                  />\n                                  <Label\n                                    htmlFor=\"coastguard\"\n                                    className=\"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-4 hover-elevate cursor-pointer peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary\"\n                                    data-testid=\"radio-role-coastguard\"\n                                  >\n                                    <Shield className=\"mb-2 h-6 w-6 text-primary\" />\n                                    <span className=\"text-sm font-medium\">Coast Guard</span>\n                                  </Label>\n                                </div>\n                              </RadioGroup>\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <Button\n                        type=\"submit\"\n                        className=\"w-full\"\n                        disabled={registerMutation.isPending}\n                        data-testid=\"button-register-submit\"\n                      >\n                        {registerMutation.isPending ? (\n                          <>\n                            <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                            Creating account...\n                          </>\n                        ) : (\n                          \"Create Account\"\n                        )}\n                      </Button>\n                    </form>\n                  </Form>\n\n                  <p className=\"text-sm text-muted-foreground text-center mt-4\">\n                    Already have an account?{\" \"}\n                    <button\n                      type=\"button\"\n                      className=\"text-primary hover:underline font-medium\"\n                      onClick={() => setActiveTab(\"login\")}\n                      data-testid=\"link-go-to-login\"\n                    >\n                      Sign in here\n                    </button>\n                  </p>\n                </TabsContent>\n              </CardContent>\n            </Tabs>\n          </Card>\n        </div>\n      </main>\n\n      <footer className=\"border-t py-6\">\n        <div className=\"container mx-auto px-4 text-center text-sm text-muted-foreground\">\n          CoastGuard Lite - Maritime Safety System\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":20176,"size_tokens":null},"server/auth.ts":{"content":"import session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport connectPg from \"connect-pg-simple\";\nimport bcrypt from \"bcrypt\";\nimport { storage } from \"./storage\";\nimport { registerSchema, loginSchema } from \"@shared/schema\";\n\nconst SALT_ROUNDS = 12;\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId: string;\n  }\n}\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  \n  return session({\n    secret: process.env.SESSION_SECRET || \"coastguard-lite-secret-key-change-in-production\",\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      maxAge: sessionTtl,\n      sameSite: \"lax\",\n    },\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n\n  // Register new user\n  app.post(\"/api/auth/register\", async (req, res) => {\n    try {\n      const validatedData = registerSchema.parse(req.body);\n      \n      // Check if email already exists\n      const existingUser = await storage.getUserByEmail(validatedData.email);\n      if (existingUser) {\n        res.status(400).json({ message: \"Email already registered\" });\n        return;\n      }\n      \n      // Hash password\n      const passwordHash = await bcrypt.hash(validatedData.password, SALT_ROUNDS);\n      \n      // Create user\n      const user = await storage.createUser({\n        email: validatedData.email,\n        passwordHash,\n        firstName: validatedData.firstName,\n        lastName: validatedData.lastName,\n        role: validatedData.role,\n      });\n      \n      // Set session\n      req.session.userId = user.id;\n      \n      // Return user without password hash\n      const { passwordHash: _, ...userWithoutPassword } = user;\n      res.json({ success: true, user: userWithoutPassword });\n    } catch (error: any) {\n      console.error(\"Registration error:\", error);\n      if (error.name === \"ZodError\") {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        res.status(500).json({ message: \"Registration failed\" });\n      }\n    }\n  });\n\n  // Login\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const validatedData = loginSchema.parse(req.body);\n      \n      // Find user by email\n      const user = await storage.getUserByEmail(validatedData.email);\n      if (!user) {\n        res.status(401).json({ message: \"Invalid email or password\" });\n        return;\n      }\n      \n      // Verify password\n      const isValid = await bcrypt.compare(validatedData.password, user.passwordHash);\n      if (!isValid) {\n        res.status(401).json({ message: \"Invalid email or password\" });\n        return;\n      }\n      \n      // Set session\n      req.session.userId = user.id;\n      \n      // Return user without password hash\n      const { passwordHash: _, ...userWithoutPassword } = user;\n      res.json({ success: true, user: userWithoutPassword });\n    } catch (error: any) {\n      console.error(\"Login error:\", error);\n      if (error.name === \"ZodError\") {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        res.status(500).json({ message: \"Login failed\" });\n      }\n    }\n  });\n\n  // Logout\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        console.error(\"Logout error:\", err);\n        res.status(500).json({ message: \"Logout failed\" });\n        return;\n      }\n      res.clearCookie(\"connect.sid\");\n      res.json({ success: true });\n    });\n  });\n\n  // Get current user\n  app.get(\"/api/auth/user\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        res.status(401).json({ message: \"Not authenticated\" });\n        return;\n      }\n      \n      const user = await storage.getUser(req.session.userId);\n      if (!user) {\n        req.session.destroy(() => {});\n        res.status(401).json({ message: \"User not found\" });\n        return;\n      }\n      \n      // Get fisherman profile if exists\n      const fishermanProfile = await storage.getFishermanProfileByUserId(user.id);\n      \n      // Return user without password hash\n      const { passwordHash: _, ...userWithoutPassword } = user;\n      res.json({\n        ...userWithoutPassword,\n        fishermanProfile: fishermanProfile || null,\n      });\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n}\n\n// Middleware to check if user is authenticated\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  if (!req.session.userId) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n  \n  const user = await storage.getUser(req.session.userId);\n  if (!user) {\n    req.session.destroy(() => {});\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n  \n  // Attach user to request for later use\n  (req as any).user = user;\n  next();\n};\n\n// Middleware to check if user has a specific role\nexport const requireRole = (role: string): RequestHandler => {\n  return async (req, res, next) => {\n    const user = (req as any).user;\n    if (!user) {\n      res.status(401).json({ message: \"Unauthorized\" });\n      return;\n    }\n    \n    if (user.role !== role) {\n      res.status(403).json({ message: \"Forbidden: Insufficient permissions\" });\n      return;\n    }\n    \n    next();\n  };\n};\n","path":null,"size_bytes":5723,"size_tokens":null},"client/src/pages/fisherman-setup.tsx":{"content":"import { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Anchor, Ship, Loader2 } from \"lucide-react\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { z } from \"zod\";\n\nconst fishermanProfileSchema = z.object({\n  fishermanName: z.string().min(1, \"Name is required\"),\n  boatName: z.string().min(1, \"Boat name is required\"),\n});\n\ntype FishermanProfileFormData = z.infer<typeof fishermanProfileSchema>;\n\nexport default function FishermanSetup() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { user } = useAuth();\n\n  const form = useForm<FishermanProfileFormData>({\n    resolver: zodResolver(fishermanProfileSchema),\n    defaultValues: {\n      fishermanName: user?.firstName && user?.lastName \n        ? `${user.firstName} ${user.lastName}` \n        : user?.firstName || \"\",\n      boatName: \"\",\n    },\n  });\n\n  const createProfileMutation = useMutation({\n    mutationFn: async (data: FishermanProfileFormData) => {\n      return apiRequest(\"POST\", \"/api/fisherman/profile\", data);\n    },\n    onSuccess: async () => {\n      await queryClient.refetchQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Profile created\",\n        description: \"Your fisherman profile has been set up successfully.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Failed to create profile\",\n        description: error instanceof Error ? error.message : \"Please try again\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", \"/api/auth/logout\", {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n    },\n  });\n\n  const onSubmit = (data: FishermanProfileFormData) => {\n    createProfileMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <header className=\"sticky top-0 z-50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b\">\n        <div className=\"container mx-auto px-4 py-3 flex items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 bg-ocean rounded-lg\">\n              <Anchor className=\"h-6 w-6 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"font-semibold text-lg\">CoastGuard Lite</h1>\n              <p className=\"text-xs text-muted-foreground\">Fisherman Setup</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <ThemeToggle />\n            <Button \n              variant=\"outline\"\n              onClick={() => logoutMutation.mutate()}\n              disabled={logoutMutation.isPending}\n              data-testid=\"button-logout\"\n            >\n              {logoutMutation.isPending ? (\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n              ) : (\n                \"Sign Out\"\n              )}\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"flex-1 container mx-auto px-4 py-12 flex items-center justify-center\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader className=\"text-center\">\n            <div className=\"w-16 h-16 bg-ocean/10 rounded-xl flex items-center justify-center mx-auto mb-4\">\n              <Ship className=\"h-8 w-8 text-ocean\" />\n            </div>\n            <CardTitle>Complete Your Profile</CardTitle>\n            <CardDescription>\n              Set up your fisherman profile to start sharing your location with the Coast Guard\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"fishermanName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Your Name</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Enter your name\"\n                          data-testid=\"input-fisherman-name\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"boatName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Boat Name</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Enter your boat name\"\n                          data-testid=\"input-boat-name\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <Button\n                  type=\"submit\"\n                  className=\"w-full bg-ocean hover:bg-ocean/90\"\n                  disabled={createProfileMutation.isPending}\n                  data-testid=\"button-create-profile\"\n                >\n                  {createProfileMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Creating profile...\n                    </>\n                  ) : (\n                    <>\n                      <Ship className=\"h-4 w-4 mr-2\" />\n                      Complete Setup\n                    </>\n                  )}\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":6408,"size_tokens":null}},"version":2}